/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, Output, Inject, Optional, EventEmitter, ElementRef, SecurityContext } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { animationFrameScheduler } from 'rxjs';
import { HighlightJS } from './highlight.service';
import { HIGHLIGHT_OPTIONS } from './highlight.model';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './highlight.service';
import * as ɵngcc2 from '@angular/platform-browser';
var Highlight = /** @class */ (function () {
    function Highlight(el, _hljs, _sanitizer, _options) {
        this._hljs = _hljs;
        this._sanitizer = _sanitizer;
        this._options = _options;
        // Stream that emits when code string is highlighted
        this.highlighted = new EventEmitter();
        this._nativeElement = el.nativeElement;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    Highlight.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.code &&
            changes.code.currentValue &&
            changes.code.currentValue !== changes.code.previousValue) {
            this.highlightElement(this.code, this.languages);
        }
    };
    /**
     * Highlighting with language detection and fix markup.
     * @param code Accepts a string with the code to highlight
     * @param languages An optional array of language names and aliases restricting detection to only those languages.
     * The subset can also be set with configure, but the local parameter overrides the option if set.
     */
    /**
     * Highlighting with language detection and fix markup.
     * @param {?} code Accepts a string with the code to highlight
     * @param {?=} languages An optional array of language names and aliases restricting detection to only those languages.
     * The subset can also be set with configure, but the local parameter overrides the option if set.
     * @return {?}
     */
    Highlight.prototype.highlightElement = /**
     * Highlighting with language detection and fix markup.
     * @param {?} code Accepts a string with the code to highlight
     * @param {?=} languages An optional array of language names and aliases restricting detection to only those languages.
     * The subset can also be set with configure, but the local parameter overrides the option if set.
     * @return {?}
     */
    function (code, languages) {
        var _this = this;
        // Set code text before highlighting
        this.setTextContent(code);
        this._hljs.highlightAuto(code, languages).subscribe((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            // Set highlighted code
            _this.setInnerHTML(res.value);
            // Check if user want to show line numbers
            if (_this.lineNumbers && _this._options && _this._options.lineNumbers) {
                _this.addLineNumbers();
            }
            // Forward highlight response to the highlighted output
            _this.highlighted.emit(res);
        }));
    };
    /**
     * @private
     * @return {?}
     */
    Highlight.prototype.addLineNumbers = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        // Clean up line numbers observer
        this.destroyLineNumbersObserver();
        animationFrameScheduler.schedule((/**
         * @return {?}
         */
        function () {
            // Add line numbers
            _this._hljs.lineNumbersBlock(_this._nativeElement).subscribe();
            // If lines count is 1, the line numbers library will not add numbers
            // Observe changes to add 'hljs-line-numbers' class only when line numbers is added to the code element
            _this._lineNumbersObs = new MutationObserver((/**
             * @return {?}
             */
            function () {
                if (_this._nativeElement.firstElementChild && _this._nativeElement.firstElementChild.tagName.toUpperCase() === 'TABLE') {
                    _this._nativeElement.classList.add('hljs-line-numbers');
                }
                _this.destroyLineNumbersObserver();
            }));
            _this._lineNumbersObs.observe(_this._nativeElement, { childList: true });
        }));
    };
    /**
     * @private
     * @return {?}
     */
    Highlight.prototype.destroyLineNumbersObserver = /**
     * @private
     * @return {?}
     */
    function () {
        if (this._lineNumbersObs) {
            this._lineNumbersObs.disconnect();
            this._lineNumbersObs = null;
        }
    };
    /**
     * @private
     * @param {?} content
     * @return {?}
     */
    Highlight.prototype.setTextContent = /**
     * @private
     * @param {?} content
     * @return {?}
     */
    function (content) {
        var _this = this;
        animationFrameScheduler.schedule((/**
         * @return {?}
         */
        function () {
            return _this._nativeElement.textContent = content;
        }));
    };
    /**
     * @private
     * @param {?} content
     * @return {?}
     */
    Highlight.prototype.setInnerHTML = /**
     * @private
     * @param {?} content
     * @return {?}
     */
    function (content) {
        var _this = this;
        animationFrameScheduler.schedule((/**
         * @return {?}
         */
        function () {
            return _this._nativeElement.innerHTML = _this._sanitizer.sanitize(SecurityContext.HTML, content);
        }));
    };
    /** @nocollapse */
    Highlight.ctorParameters = function () { return [
        { type: ElementRef },
        { type: HighlightJS },
        { type: DomSanitizer },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [HIGHLIGHT_OPTIONS,] }] }
    ]; };
    Highlight.propDecorators = {
        code: [{ type: Input, args: ['highlight',] }],
        languages: [{ type: Input }],
        lineNumbers: [{ type: Input }],
        highlighted: [{ type: Output }]
    };
Highlight.ɵfac = function Highlight_Factory(t) { return new (t || Highlight)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.HighlightJS), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DomSanitizer), ɵngcc0.ɵɵdirectiveInject(HIGHLIGHT_OPTIONS, 8)); };
Highlight.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: Highlight, selectors: [["", "highlight", ""]], hostVars: 2, hostBindings: function Highlight_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("hljs", true);
    } }, inputs: { code: ["highlight", "code"], languages: "languages", lineNumbers: "lineNumbers" }, outputs: { highlighted: "highlighted" }, features: [ɵngcc0.ɵɵNgOnChangesFeature] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(Highlight, [{
        type: Directive,
        args: [{
                host: {
                    '[class.hljs]': 'true'
                },
                selector: '[highlight]'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc1.HighlightJS }, { type: ɵngcc2.DomSanitizer }, { type: undefined, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [HIGHLIGHT_OPTIONS]
            }] }]; }, { highlighted: [{
            type: Output
        }], code: [{
            type: Input,
            args: ['highlight']
        }], languages: [{
            type: Input
        }], lineNumbers: [{
            type: Input
        }] }); })();
    return Highlight;
}());
export { Highlight };
if (false) {
    /**
     * @type {?}
     * @private
     */
    Highlight.prototype._nativeElement;
    /**
     * @type {?}
     * @private
     */
    Highlight.prototype._lineNumbersObs;
    /** @type {?} */
    Highlight.prototype.code;
    /** @type {?} */
    Highlight.prototype.languages;
    /** @type {?} */
    Highlight.prototype.lineNumbers;
    /** @type {?} */
    Highlight.prototype.highlighted;
    /**
     * @type {?}
     * @private
     */
    Highlight.prototype._hljs;
    /**
     * @type {?}
     * @private
     */
    Highlight.prototype._sanitizer;
    /**
     * @type {?}
     * @private
     */
    Highlight.prototype._options;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlnaGxpZ2h0LmpzIiwic291cmNlcyI6WyJuZ3gtaGlnaGxpZ2h0anMvbGliL2hpZ2hsaWdodC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLE1BQU0sRUFDTixRQUFRLEVBR1IsWUFBWSxFQUNaLFVBQVUsRUFDVixlQUFlLEVBQ2hCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxpQkFBaUIsRUFBcUMsTUFBTSxtQkFBbUIsQ0FBQzs7OztBQUV6RjtBQUVxQixJQXlCbkIsbUJBQVksRUFBYyxFQUNOLEtBQWtCLEVBQ2xCLFVBQXdCLEVBQ2UsUUFBMEI7QUFDdkYsUUFIc0IsVUFBSyxHQUFMLEtBQUssQ0FBYTtBQUFFLFFBQ3BCLGVBQVUsR0FBVixVQUFVLENBQWM7QUFBRSxRQUNhLGFBQVEsR0FBUixRQUFRLENBQWtCO0FBQUU7QUFJbEYsUUFUSyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFtQixDQUFDO0FBQzlELFFBS0ksSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDO0FBQzNDLElBQUUsQ0FBQztBQUNIO0FBQ087QUFBMkI7QUFFL0I7QUFBUyxJQUZWLCtCQUFXO0FBQVE7QUFDZDtBQUNVO0FBQ2QsSUFIRCxVQUFZLE9BQXNCO0FBQ3BDLFFBQUksSUFDRSxPQUFPLENBQUMsSUFBSTtBQUNsQixZQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWTtBQUMvQixZQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWSxLQUFLLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUN4RDtBQUNOLFlBQU0sSUFBSSxD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QUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUtBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWFBLEFBWkEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFnQkEsQUFmQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBSUEsQUFIQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBSUEsQUFIQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQXBHQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQWJBLEFBQUEsQUFLQSxBQUFBLEFBRkEsQUFBQSxBQW1DQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFmQSxBQUFBLEFBQUEsQUFBQSxBQUlBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQTRFQSxBQUFBLEFBQUEsQUFyR0EsQUFxR0EsQUEvRkEsQUFBQSxBQUdBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQUlBLEFBQUEsQUFHQSxBQUFBLEFBR0EsQUFBQSxBQUdBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgRGlyZWN0aXZlLFxyXG4gIElucHV0LFxyXG4gIE91dHB1dCxcclxuICBJbmplY3QsXHJcbiAgT3B0aW9uYWwsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIFNpbXBsZUNoYW5nZXMsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgU2VjdXJpdHlDb250ZXh0XHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERvbVNhbml0aXplciB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQgeyBhbmltYXRpb25GcmFtZVNjaGVkdWxlciB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBIaWdobGlnaHRKUyB9IGZyb20gJy4vaGlnaGxpZ2h0LnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBISUdITElHSFRfT1BUSU9OUywgSGlnaGxpZ2h0T3B0aW9ucywgSGlnaGxpZ2h0UmVzdWx0IH0gZnJvbSAnLi9oaWdobGlnaHQubW9kZWwnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgaG9zdDoge1xyXG4gICAgJ1tjbGFzcy5obGpzXSc6ICd0cnVlJ1xyXG4gIH0sXHJcbiAgc2VsZWN0b3I6ICdbaGlnaGxpZ2h0XSdcclxufSlcclxuZXhwb3J0IGNsYXNzIEhpZ2hsaWdodCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XHJcblxyXG4gIC8vIEhpZ2hsaWdodGVkIENvZGVcclxuICBwcml2YXRlIHJlYWRvbmx5IF9uYXRpdmVFbGVtZW50OiBIVE1MRWxlbWVudDtcclxuXHJcbiAgLy8gVGVtcCBvYnNlcnZlciB0byBvYnNlcnZlIHdoZW4gbGluZSBudW1iZXJzIGhhcyBiZWVuIGFkZGVkIHRvIGNvZGUgZWxlbWVudFxyXG4gIHByaXZhdGUgX2xpbmVOdW1iZXJzT2JzOiBhbnk7XHJcblxyXG4gIC8vIEhpZ2hsaWdodCBjb2RlIGlucHV0XHJcbiAgQElucHV0KCdoaWdobGlnaHQnKSBjb2RlITogc3RyaW5nO1xyXG5cclxuICAvLyBBbiBvcHRpb25hbCBhcnJheSBvZiBsYW5ndWFnZSBuYW1lcyBhbmQgYWxpYXNlcyByZXN0cmljdGluZyBkZXRlY3Rpb24gdG8gb25seSB0aG9zZSBsYW5ndWFnZXMuXHJcbiAgLy8gVGhlIHN1YnNldCBjYW4gYWxzbyBiZSBzZXQgd2l0aCBjb25maWd1cmUsIGJ1dCB0aGUgbG9jYWwgcGFyYW1ldGVyIG92ZXJyaWRlcyB0aGUgb3B0aW9uIGlmIHNldC5cclxuICBASW5wdXQoKSBsYW5ndWFnZXMhOiBzdHJpbmdbXTtcclxuXHJcbiAgLy8gU2hvdyBsaW5lIG51bWJlcnNcclxuICBASW5wdXQoKSBsaW5lTnVtYmVycyE6IGJvb2xlYW47XHJcblxyXG4gIC8vIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gY29kZSBzdHJpbmcgaXMgaGlnaGxpZ2h0ZWRcclxuICBAT3V0cHV0KCkgaGlnaGxpZ2h0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPEhpZ2hsaWdodFJlc3VsdD4oKTtcclxuXHJcbiAgY29uc3RydWN0b3IoZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBfaGxqczogSGlnaGxpZ2h0SlMsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBfc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsXHJcbiAgICAgICAgICAgICAgQE9wdGlvbmFsKCkgQEluamVjdChISUdITElHSFRfT1BUSU9OUykgcHJpdmF0ZSBfb3B0aW9uczogSGlnaGxpZ2h0T3B0aW9ucykge1xyXG4gICAgdGhpcy5fbmF0aXZlRWxlbWVudCA9IGVsLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICBpZiAoXHJcbiAgICAgIGNoYW5nZXMuY29kZSAmJlxyXG4gICAgICBjaGFuZ2VzLmNvZGUuY3VycmVudFZhbHVlICYmXHJcbiAgICAgIGNoYW5nZXMuY29kZS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXMuY29kZS5wcmV2aW91c1ZhbHVlXHJcbiAgICApIHtcclxuICAgICAgdGhpcy5oaWdobGlnaHRFbGVtZW50KHRoaXMuY29kZSwgdGhpcy5sYW5ndWFnZXMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGlnaGxpZ2h0aW5nIHdpdGggbGFuZ3VhZ2UgZGV0ZWN0aW9uIGFuZCBmaXggbWFya3VwLlxyXG4gICAqIEBwYXJhbSBjb2RlIEFjY2VwdHMgYSBzdHJpbmcgd2l0aCB0aGUgY29kZSB0byBoaWdobGlnaHRcclxuICAgKiBAcGFyYW0gbGFuZ3VhZ2VzIEFuIG9wdGlvbmFsIGFycmF5IG9mIGxhbmd1YWdlIG5hbWVzIGFuZCBhbGlhc2VzIHJlc3RyaWN0aW5nIGRldGVjdGlvbiB0byBvbmx5IHRob3NlIGxhbmd1YWdlcy5cclxuICAgKiBUaGUgc3Vic2V0IGNhbiBhbHNvIGJlIHNldCB3aXRoIGNvbmZpZ3VyZSwgYnV0IHRoZSBsb2NhbCBwYXJhbWV0ZXIgb3ZlcnJpZGVzIHRoZSBvcHRpb24gaWYgc2V0LlxyXG4gICAqL1xyXG4gIGhpZ2hsaWdodEVsZW1lbnQoY29kZTogc3RyaW5nLCBsYW5ndWFnZXM/OiBzdHJpbmdbXSk6IHZvaWQge1xyXG4gICAgLy8gU2V0IGNvZGUgdGV4dCBiZWZvcmUgaGlnaGxpZ2h0aW5nXHJcbiAgICB0aGlzLnNldFRleHRDb250ZW50KGNvZGUpO1xyXG4gICAgdGhpcy5faGxqcy5oaWdobGlnaHRBdXRvKGNvZGUsIGxhbmd1YWdlcykuc3Vic2NyaWJlKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAvLyBTZXQgaGlnaGxpZ2h0ZWQgY29kZVxyXG4gICAgICB0aGlzLnNldElubmVySFRNTChyZXMudmFsdWUpO1xyXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIHdhbnQgdG8gc2hvdyBsaW5lIG51bWJlcnNcclxuICAgICAgaWYgKHRoaXMubGluZU51bWJlcnMgJiYgdGhpcy5fb3B0aW9ucyAmJiB0aGlzLl9vcHRpb25zLmxpbmVOdW1iZXJzKSB7XHJcbiAgICAgICAgdGhpcy5hZGRMaW5lTnVtYmVycygpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIEZvcndhcmQgaGlnaGxpZ2h0IHJlc3BvbnNlIHRvIHRoZSBoaWdobGlnaHRlZCBvdXRwdXRcclxuICAgICAgdGhpcy5oaWdobGlnaHRlZC5lbWl0KHJlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYWRkTGluZU51bWJlcnMoKSB7XHJcbiAgICAvLyBDbGVhbiB1cCBsaW5lIG51bWJlcnMgb2JzZXJ2ZXJcclxuICAgIHRoaXMuZGVzdHJveUxpbmVOdW1iZXJzT2JzZXJ2ZXIoKTtcclxuICAgIGFuaW1hdGlvbkZyYW1lU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgLy8gQWRkIGxpbmUgbnVtYmVyc1xyXG4gICAgICB0aGlzLl9obGpzLmxpbmVOdW1iZXJzQmxvY2sodGhpcy5fbmF0aXZlRWxlbWVudCkuc3Vic2NyaWJlKCk7XHJcbiAgICAgIC8vIElmIGxpbmVzIGNvdW50IGlzIDEsIHRoZSBsaW5lIG51bWJlcnMgbGlicmFyeSB3aWxsIG5vdCBhZGQgbnVtYmVyc1xyXG4gICAgICAvLyBPYnNlcnZlIGNoYW5nZXMgdG8gYWRkICdobGpzLWxpbmUtbnVtYmVycycgY2xhc3Mgb25seSB3aGVuIGxpbmUgbnVtYmVycyBpcyBhZGRlZCB0byB0aGUgY29kZSBlbGVtZW50XHJcbiAgICAgIHRoaXMuX2xpbmVOdW1iZXJzT2JzID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLl9uYXRpdmVFbGVtZW50LmZpcnN0RWxlbWVudENoaWxkICYmIHRoaXMuX25hdGl2ZUVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQudGFnTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnVEFCTEUnKSB7XHJcbiAgICAgICAgICB0aGlzLl9uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2hsanMtbGluZS1udW1iZXJzJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZGVzdHJveUxpbmVOdW1iZXJzT2JzZXJ2ZXIoKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuX2xpbmVOdW1iZXJzT2JzLm9ic2VydmUodGhpcy5fbmF0aXZlRWxlbWVudCwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGVzdHJveUxpbmVOdW1iZXJzT2JzZXJ2ZXIoKSB7XHJcbiAgICBpZiAodGhpcy5fbGluZU51bWJlcnNPYnMpIHtcclxuICAgICAgdGhpcy5fbGluZU51bWJlcnNPYnMuZGlzY29ubmVjdCgpO1xyXG4gICAgICB0aGlzLl9saW5lTnVtYmVyc09icyA9IG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFRleHRDb250ZW50KGNvbnRlbnQ6IHN0cmluZykge1xyXG4gICAgYW5pbWF0aW9uRnJhbWVTY2hlZHVsZXIuc2NoZWR1bGUoKCkgPT5cclxuICAgICAgdGhpcy5fbmF0aXZlRWxlbWVudC50ZXh0Q29udGVudCA9IGNvbnRlbnRcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldElubmVySFRNTChjb250ZW50OiBzdHJpbmcpIHtcclxuICAgIGFuaW1hdGlvbkZyYW1lU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+XHJcbiAgICAgIHRoaXMuX25hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MID0gdGhpcy5fc2FuaXRpemVyLnNhbml0aXplKFNlY3VyaXR5Q29udGV4dC5IVE1MLCBjb250ZW50KVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbiJdfQ==
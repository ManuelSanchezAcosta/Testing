/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output, Renderer2, ChangeDetectionStrategy, } from '@angular/core';
import imagesLoadedMethod from 'imagesloaded';
import * as masonry from 'masonry-layout';
import { utilities } from './utilities';
import * as Éµngcc0 from '@angular/core';
var MasonryGalleryComponent = /** @class */ (function () {
    function MasonryGalleryComponent(renderer) {
        this.renderer = renderer;
        this.images = [];
        this.width = 330;
        this.gutter = 5;
        this.verticalGutter = 5;
        this.imageClasses = [];
        this.clickImage = new EventEmitter();
        this.removeComplete = new EventEmitter();
        this.layoutComplete = new EventEmitter();
        this.galleryGuid = utilities.newGuid();
        this.mansonryItemSelectorClass = "grid-item-" + this.galleryGuid;
        this.activeImages = [];
        this.viewReady = false;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    MasonryGalleryComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.images && changes.images.currentValue) {
            if (!this.viewReady) {
                // process images once we can
                this.changesToProcess = changes;
            }
            else {
                this.processImages(changes);
            }
        }
    };
    /**
     * @return {?}
     */
    MasonryGalleryComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.msnry) {
            this.msnry.destroy();
        }
    };
    /**
     * @param {?} image
     * @return {?}
     */
    MasonryGalleryComponent.prototype.handleClick = /**
     * @param {?} image
     * @return {?}
     */
    function (image) {
        this.clickImage.next(image);
    };
    /**
     * @return {?}
     */
    MasonryGalleryComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.viewReady = true;
        this.initMasonry();
        // process images now
        if (this.changesToProcess) {
            this.processImages(this.changesToProcess);
            this.changesToProcess = undefined;
        }
    };
    /**
     * @param {?} images
     * @return {?}
     */
    MasonryGalleryComponent.prototype.addImages = /**
     * @param {?} images
     * @return {?}
     */
    function (images) {
        if (images && images.length > 0) {
            this.addImagesToGallery(images);
        }
    };
    /**
     * @param {?} images
     * @return {?}
     */
    MasonryGalleryComponent.prototype.removeImages = /**
     * @param {?} images
     * @return {?}
     */
    function (images) {
        var _this = this;
        if (images && images.length > 0) {
            images.forEach((/**
             * @param {?} image
             * @return {?}
             */
            function (image) {
                _this.removeImageFromGallery(image);
            }));
        }
    };
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    MasonryGalleryComponent.prototype.processImages = /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var imagesToProcess = this.getAddedAndRemovesImages(changes);
        // add images to mansonry layout
        this.addImages(imagesToProcess.addedImages);
        // removes images from layout
        this.removeImages(imagesToProcess.removedImages);
    };
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    MasonryGalleryComponent.prototype.getAddedAndRemovesImages = /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var addedImages = [];
        /** @type {?} */
        var removedImages = [];
        /** @type {?} */
        var newImagesValue = (/** @type {?} */ (changes.images
            .currentValue));
        /** @type {?} */
        var oldImagesValue = (/** @type {?} */ (changes.images
            .previousValue));
        if (!oldImagesValue) {
            // all images are new ones
            addedImages = changes.images.currentValue;
        }
        else {
            // process added images
            newImagesValue.forEach((/**
             * @param {?} newImage
             * @return {?}
             */
            function (newImage) {
                /** @type {?} */
                var existingImage = oldImagesValue.find((/**
                 * @param {?} m
                 * @return {?}
                 */
                function (m) { return m.imageUrl.toLowerCase() === newImage.imageUrl.toLowerCase(); }));
                if (existingImage) {
                    // image was in previous value && is in new, do nothing
                }
                else {
                    // image is new
                    addedImages.push(newImage);
                }
            }));
            // process removed images
            oldImagesValue.forEach((/**
             * @param {?} oldImage
             * @return {?}
             */
            function (oldImage) {
                /** @type {?} */
                var existingImage = newImagesValue.find((/**
                 * @param {?} m
                 * @return {?}
                 */
                function (m) { return m.imageUrl.toLowerCase() === oldImage.imageUrl.toLowerCase(); }));
                if (existingImage) {
                    // image was in previous value && is in new, do nothing
                }
                else {
                    // image is removed
                    removedImages.push(oldImage);
                }
            }));
        }
        return {
            addedImages: addedImages,
            removedImages: removedImages
        };
    };
    /**
     * @private
     * @return {?}
     */
    MasonryGalleryComponent.prototype.initMasonry = /**
     * @private
     * @return {?}
     */
    function () {
        this.grid = document.getElementById(this.galleryGuid);
        // remove all existing data from grid
        this.grid.innerHTML = '';
        if (!this.grid) {
            throw Error("Could not init mansory due to non existing elem with id '" + this.galleryGuid + "'");
        }
        this.msnry = new masonry(this.grid, {
            // options...
            itemSelector: '.' + this.mansonryItemSelectorClass,
            columnWidth: this.width,
            gutter: this.gutter,
        });
        /** @type {?} */
        var that = this;
        this.msnry.on('layoutComplete', (/**
         * @param {?} items
         * @return {?}
         */
        function (items) {
            that.layoutComplete.next(items);
        }));
        this.msnry.on('removeComplete', (/**
         * @param {?} items
         * @return {?}
         */
        function (items) {
            that.removeComplete.next(items);
        }));
    };
    /**
     * @private
     * @param {?} image
     * @return {?}
     */
    MasonryGalleryComponent.prototype.removeImageFromGallery = /**
     * @private
     * @param {?} image
     * @return {?}
     */
    function (image) {
        // get image guid
        /** @type {?} */
        var imageIdResult = this.activeImages.find((/**
         * @param {?} m
         * @return {?}
         */
        function (m) { return m.image.imageUrl.toLowerCase() === image.imageUrl.toLowerCase(); }));
        if (!imageIdResult) {
            // image was not found, this is probably an error
            console.warn("Image with url '" + image.imageUrl + "' was not found. If you are adding images, make sure to 'replace' the images array with a new one\n                so that detection change can be executed instead of just adding an image to array\n                (which doesn't fire change detection on array property)");
            return;
        }
        // find image based on its id
        /** @type {?} */
        var imageElem = document.getElementById(imageIdResult.id);
        if (!imageElem) {
            // image was not found in DOM
            console.warn("Image with id '{" + imageIdResult.id + "}' was not found in DOM. Have you manipulated the DOM in some way?");
            return;
        }
        // remove image from gallery
        this.msnry.remove(imageElem);
        // refresh layout
        this.msnry.layout();
        // remove image from array
        for (var i = 0; i < this.activeImages.length; i++) {
            /** @type {?} */
            var idWithImage = this.activeImages[i];
            if (idWithImage.image.imageUrl.toLowerCase() ===
                imageIdResult.image.imageUrl.toLowerCase()) {
                this.activeImages.splice(i, 1);
            }
        }
    };
    /**
     * @private
     * @param {?} images
     * @return {?}
     */
    MasonryGalleryComponent.prototype.addImagesToGallery = /**
     * @private
     * @param {?} images
     * @return {?}
     */
    function (images) {
        var _this = this;
        if (!this.grid) {
            throw Error('Grid element is not yet ready, are you trying to add image too soon?');
        }
        /** @type {?} */
        var imagesWrapper = this.renderer.createElement('span');
        images.forEach((/**
         * @param {?} image
         * @return {?}
         */
        function (image) {
            // generate unique image id
            /** @type {?} */
            var imageId = _this.getImageId();
            // create element
            /** @type {?} */
            var imageElem = _this.renderer.createElement('img');
            imageElem.setAttribute('id', imageId);
            imageElem.setAttribute('alt', image.alt ? image.alt : 'no description');
            imageElem.setAttribute('src', image.imageUrl);
            // note - images are hidden by default and should be shown only after they are loaded
            imageElem.setAttribute('style', "display: none; width: " + _this.width + "px; margin-bottom: " + _this.verticalGutter + "px");
            imageElem.className = _this.getImageClass();
            imageElem.addEventListener('click', (/**
             * @return {?}
             */
            function () {
                _this.handleClick(image);
            }));
            // store guid with this image
            _this.activeImages.push({
                id: imageId,
                image: image
            });
            // add to dom and mansory & refresh layout
            _this.renderer.appendChild(imagesWrapper, imageElem);
        }));
        // add html to dom
        this.renderer.appendChild(this.grid, imagesWrapper);
        // add images once they are loaded
        /** @type {?} */
        var imgLoad = imagesLoadedMethod(imagesWrapper);
        imgLoad.on('progress', (/**
         * @param {?} instance
         * @param {?} image
         * @return {?}
         */
        function (instance, image) {
            if (image.isLoaded) {
                _this.renderer.appendChild(_this.grid, image.img);
                // unhide image
                _this.renderer.setStyle(image.img, 'display', 'block');
                _this.msnry.appended(image.img);
                _this.msnry.reloadItems();
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    MasonryGalleryComponent.prototype.getImageClass = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var className = this.mansonryItemSelectorClass;
        if (this.imageClasses && this.imageClasses.length > 0) {
            /** @type {?} */
            var customClass = this.imageClasses.join(' ');
            className += ' ' + customClass;
        }
        return className;
    };
    /**
     * @private
     * @return {?}
     */
    MasonryGalleryComponent.prototype.getImageId = /**
     * @private
     * @return {?}
     */
    function () {
        return this.galleryGuid + '_' + utilities.newGuid();
    };
    /** @nocollapse */
    MasonryGalleryComponent.ctorParameters = function () { return [
        { type: Renderer2 }
    ]; };
    MasonryGalleryComponent.propDecorators = {
        images: [{ type: Input }],
        width: [{ type: Input }],
        gutter: [{ type: Input }],
        verticalGutter: [{ type: Input }],
        imageClasses: [{ type: Input }],
        clickImage: [{ type: Output }],
        removeComplete: [{ type: Output }],
        layoutComplete: [{ type: Output }]
    };
MasonryGalleryComponent.Éµfac = function MasonryGalleryComponent_Factory(t) { return new (t || MasonryGalleryComponent)(Éµngcc0.ÉµÉµdirectiveInject(Éµngcc0.Renderer2)); };
MasonryGalleryComponent.Éµcmp = Éµngcc0.ÉµÉµdefineComponent({ type: MasonryGalleryComponent, selectors: [["ngx-masonry-gallery"]], inputs: { images: "images", width: "width", gutter: "gutter", verticalGutter: "verticalGutter", imageClasses: "imageClasses" }, outputs: { clickImage: "clickImage", removeComplete: "removeComplete", layoutComplete: "layoutComplete" }, features: [Éµngcc0.ÉµÉµNgOnChangesFeature], decls: 1, vars: 1, consts: [[3, "id"]], template: function MasonryGalleryComponent_Template(rf, ctx) { if (rf & 1) {
        Éµngcc0.ÉµÉµelement(0, "div", 0);
    } if (rf & 2) {
        Éµngcc0.ÉµÉµproperty("id", ctx.galleryGuid);
    } }, encapsulation: 2, changeDetection: 0 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && Éµngcc0.ÉµsetClassMetadata(MasonryGalleryComponent, [{
        type: Component,
        args: [{
                changeDetection: ChangeDetectionStrategy.OnPush,
                selector: 'ngx-masonry-gallery',
                template: '<div [id]="galleryGuid"></div>'
            }]
    }], function () { return [{ type: Éµngcc0.Renderer2 }]; }, { images: [{
            type: Input
        }], width: [{
            type: Input
        }], gutter: [{
            type: Input
        }], verticalGutter: [{
            type: Input
        }], imageClasses: [{
            type: Input
        }], clickImage: [{
            type: Output
        }], removeComplete: [{
            type: Output
        }], layoutComplete: [{
            type: Output
        }] }); })();
    return MasonryGalleryComponent;
}());
export { MasonryGalleryComponent };
if (false) {
    /** @type {?} */
    MasonryGalleryComponent.prototype.images;
    /** @type {?} */
    MasonryGalleryComponent.prototype.width;
    /** @type {?} */
    MasonryGalleryComponent.prototype.gutter;
    /** @type {?} */
    MasonryGalleryComponent.prototype.verticalGutter;
    /** @type {?} */
    MasonryGalleryComponent.prototype.imageClasses;
    /** @type {?} */
    MasonryGalleryComponent.prototype.clickImage;
    /** @type {?} */
    MasonryGalleryComponent.prototype.removeComplete;
    /** @type {?} */
    MasonryGalleryComponent.prototype.layoutComplete;
    /** @type {?} */
    MasonryGalleryComponent.prototype.galleryGuid;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.mansonryItemSelectorClass;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.activeImages;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.msnry;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.grid;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.changesToProcess;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.viewReady;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.renderer;
}
/**
 * @record
 */
function ActiveImage() { }
if (false) {
    /** @type {?} */
    ActiveImage.prototype.id;
    /** @type {?} */
    ActiveImage.prototype.image;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFzb25yeS1nYWxsZXJ5LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsibmd4LW1hc29ucnktZ2FsbGVyeS9saWIvbWFzb25yeS1nYWxsZXJ5LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUVILFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUdMLE1BQU0sRUFDTixTQUFTLEVBRVQsdUJBQXVCLEdBQzFCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sa0JBQWtCLE1BQU0sY0FBYyxDQUFDO0FBQzlDLE9BQU8sS0FBSyxPQUFPLE1BQU0sZ0JBQWdCLENBQUM7QUFHMUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQzs7QUFFeEM7QUFDOEMsSUEwQjFDLGlDQUFvQixRQUFtQjtBQUFLLFFBQXhCLGFBQVEsR0FBUixRQUFRLENBQVc7QUFBRSxRQXBCaEMsV0FBTSxHQUEyQixFQUFFLENBQUM7QUFDakQsUUFBYSxVQUFLLEdBQVcsR0FBRyxDQUFDO0FBQ2pDLFFBQWEsV0FBTSxHQUFXLENBQUMsQ0FBQztBQUNoQyxRQUFhLG1CQUFjLEdBQVcsQ0FBQyxDQUFDO0FBQ3hDLFFBQWEsaUJBQVksR0FBYSxFQUFFLENBQUM7QUFDekMsUUFDYyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQXdCLENBQUM7QUFDcEUsUUFBYyxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFTLENBQUM7QUFDekQsUUFBYyxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFTLENBQUM7QUFDekQsUUFDb0IsZ0JBQVcsR0FBVyxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDOUQsUUFDcUIsOEJBQXlCLEdBQUcsZUFBYSxJQUFJLENBQUMsV0FBYSxDQUFDO0FBQ2pGLFFBQXFCLGlCQUFZLEdBQWtCLEVBQUUsQ0FBQztBQUN0RCxRQUlZLGNBQVMsR0FBWSxLQUFLLENBQUM7QUFDdkMsSUFDK0MsQ0FBQztBQUNoRDtBQUNPO0FBQTJCO0FBQzdCO0FBQVMsSUFEViw2Q0FBVztBQUFRO0FBQ3RCO0FBQW9CO0FBQVMsSUFEMUIsVUFBWSxPQUFzQjtBQUFLLFFBQ25DLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRTtBQUMzRCxZQUFZLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO0FBQ2pDLGdCQUFnQiw2QkFBNkI7QUFDN0MsZ0JBQWdCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxPQUFPLENBQUM7QUFDaEQsYUFBYTtBQUFFLGlCQUFJO0FBQ25CLGdCQUFnQixJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzVDLGFBQWE7QUFDYixTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0o7QUFDTztBQUNQO0FBQVMsSUFETiw2Q0FBVztBQUFRO0FBQ1A7QUFBUyxJQURyQjtBQUFlLFFBQ1gsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO0FBQ3hCLFlBQVksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUNqQyxTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0o7QUFDTztBQUF5QjtBQUFvQjtBQUM3QyxJQURKLDZDQUFXO0FBQVE7QUFBeUI7QUFDbEM7QUFBUyxJQURuQixVQUFZLEtBQTJCO0FBQUssUUFDeEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDcEMsSUFBSSxDQUFDO0FBQ0o7QUFDTztBQUFvQjtBQUN0QixJQURGLGlEQUFlO0FBQVE7QUFDWDtBQUFTLElBRHJCO0FBQWUsUUFDWCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztBQUM5QixRQUFRLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUMzQixRQUNRLHFCQUFxQjtBQUM3QixRQUFRLElBQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFO0FBQ25DLFlBQVksSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUN0RCxZQUFZLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxTQUFTLENBQUM7QUFDOUMsU0FBUztBQUNULElBQUksQ0FBQztBQUNKO0FBQ087QUFBMEI7QUFBb0I7QUFDOUMsSUFESiwyQ0FBUztBQUFRO0FBQTBCO0FBQ25DO0FBQVMsSUFEakIsVUFBVSxNQUE4QjtBQUFLLFFBQ3pDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ3pDLFlBQVksSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzVDLFNBQVM7QUFDVCxJQUFJLENBQUM7QUFDSjtBQUNPO0FBQTBCO0FBQW9CO0FBQ2pELElBREQsOENBQVk7QUFBUTtBQUEwQjtBQUN0QztBQUFTLElBRGpCLFVBQWEsTUFBOEI7QUFBSyxRQUFoRCxpQkFNQztBQUNMLFFBTlEsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7QUFDekMsWUFBWSxNQUFNLENBQUMsT0FBTztBQUFPO0FBQ047QUFDekI7QUFDQSxZQUh5QixVQUFBLEtBQUs7QUFBSyxnQkFDckIsS0FBSSxDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ25ELFlBQVksQ0FBQyxFQUFDLENBQUM7QUFDZixTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0o7QUFDTztBQUFpQjtBQUEyQjtBQUN2QztBQUFTLElBRFYsK0NBQWE7QUFBUTtBQUFpQjtBQUNoQztBQUFvQjtBQUFTLElBRDNDLFVBQXNCLE9BQXNCO0FBQUs7QUFDakMsWUFBTixlQUFlLEdBQUcsSUFBSSxDQUFDLHdCQUF3QixDQUFDLE9BQU8sQ0FBQztBQUN0RSxRQUNRLGdDQUFnQztBQUN4QyxRQUFRLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ3BELFFBQ1EsNkJBQTZCO0FBQ3JDLFFBQVEsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDekQsSUFBSSxDQUFDO0FBQ0o7QUFDTztBQUFpQjtBQUNaO0FBQ1o7QUFDRCxJQUhZLDBEQUF3QjtBQUMvQjtBQUFpQjtBQUVmO0FBQW9CO0FBQVMsSUFIaEMsVUFDSSxPQUFzQjtBQUMzQjtBQUNnQixZQUdQLFdBQVcsR0FBMkIsRUFBRTtBQUNwRDtBQUEwQixZQUFaLGFBQWEsR0FBMkIsRUFBRTtBQUN4RDtBQUN3QixZQUFWLGNBQWMsR0FBRyxtQkFBQSxPQUFPLENBQUMsTUFBTTtBQUM3QyxhQUFhLFlBQVksRUFBMEI7QUFDbkQ7QUFBMEIsWUFBWixjQUFjLEdBQUcsbUJBQUEsT0FBTyxDQUFDLE1BQU07QUFDN0MsYUFBYSxhQUFhLEVBQTBCO0FBQ3BELFFBQ1EsSUFBSSxDQUFDLGNBQWMsRUFBRTtBQUM3QixZQUFZLDBCQUEwQjtBQUN0QyxZQUFZLFdBQVcsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQztBQUN0RCxTQUFTO0FBQUUsYUFBSTtBQUNmLFlBQVksdUJBQXVCO0FBQ25DLFlBQVksY0FBYyxDQUFDLE9BQU87QUFBTztBQUNkO0FBQTRCO0FBQzNDLFlBRnVCLFVBQUEsUUFBUTtBQUFLO0FBQ2hCLG9CQUFWLGFBQWEsR0FBRyxjQUFjLENBQUMsSUFBSTtBQUNyRDtBQUFpQztBQUFnQztBQUNsRSxnQkFEaUIsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxLQUFLLFFBQVEsQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLEVBQTVELENBQTRELEVBQ3BFO0FBQ2pCLGdCQUNnQixJQUFJLGFBQWEsRUFBRTtBQUNuQyxvQkFBb0IsdURBQXVEO0FBQzNFLGlCQUFpQjtBQUFFLHFCQUFJO0FBQ3ZCLG9CQUFvQixlQUFlO0FBQ25DLG9CQUFvQixXQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9DLGlCQUFpQjtBQUNqQixZQUFZLENBQUMsRUFBQyxDQUFDO0FBQ2YsWUFDWSx5QkFBeUI7QUFDckMsWUFBWSxjQUFjLENBQUMsT0FBTztBQUFPO0FBQ2Q7QUFBNEI7QUFDM0MsWUFGdUIsVUFBQSxRQUFRO0FBQUs7QUFDaEIsb0JBQVYsYUFBYSxHQUFHLGNBQWMsQ0FBQyxJQUFJO0FBQ3JEO0FBQWlDO0FBQWdDO0FBQ2xFLGdCQURpQixVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLEtBQUssUUFBUSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsRUFBNUQsQ0FBNEQsRUFDcEU7QUFDakIsZ0JBQ2dCLElBQUksYUFBYSxFQUFFO0FBQ25DLG9CQUFvQix1REFBdUQ7QUFDM0UsaUJBQWlCO0FBQUUscUJBQUk7QUFDdkIsb0JBQW9CLG1CQUFtQjtBQUN2QyxvQkFBb0IsYUFBYSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqRCxpQkFBaUI7QUFDakIsWUFBWSxDQUFDLEVBQUMsQ0FBQztBQUNmLFNBQVM7QUFDVCxRQUNRLE9BQU87QUFDZixZQUFZLFdBQVcsRUFBRSxXQUFXO0FBQ3BDLFlBQVksYUFBYSxFQUFFLGFBQWE7QUFDeEMsU0FBUyxDQUFDO0FBQ1YsSUFBSSxDQUFDO0FBQ0o7QUFDTztBQUFpQjtBQUNmO0FBQVMsSUFEUCw2Q0FBVztBQUFRO0FBQ2xCO0FBQW9CO0FBQVMsSUFEdEM7QUFBZSxRQUNYLElBQUksQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDOUQsUUFDUSxxQ0FBcUM7QUFDN0MsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7QUFDakMsUUFDUSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRTtBQUN4QixZQUFZLE1BQU0sS0FBSyxDQUNQLDhEQUNBLElBQUksQ0FBQyxXQUFXLE1BQ2IsQ0FDTixDQUFDO0FBQ2QsU0FBUztBQUNULFFBQ1EsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFO0FBQzVDO0FBQ0EsWUFBWSxZQUFZLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyx5QkFBeUI7QUFDOUQsWUFBWSxXQUFXLEVBQUUsSUFBSSxDQUFDLEtBQUs7QUFDbkMsWUFBWSxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU07QUFDL0IsU0FBUyxDQUFDLENBQUM7QUFDWDtBQUN3QixZQUFWLElBQUksR0FBRyxJQUFJO0FBQ3pCLFFBQ1EsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsZ0JBQWdCO0FBQVE7QUFDL0I7QUFBd0I7QUFDakMsUUFGa0MsVUFBVSxLQUFLO0FBQ3ZELFlBQVksSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUMsUUFBUSxDQUFDLEVBQUMsQ0FBQztBQUNYLFFBQ1EsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsZ0JBQWdCO0FBQVE7QUFDL0I7QUFBd0I7QUFDakMsUUFGa0MsVUFBVSxLQUFLO0FBQ3ZELFlBQVksSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUMsUUFBUSxDQUFDLEVBQUMsQ0FBQztBQUNYLElBQUksQ0FBQztBQUNKO0FBQ087QUFBaUI7QUFBeUI7QUFBb0I7QUFDaEUsSUFETSx3REFBc0I7QUFBUTtBQUFpQjtBQUNoRDtBQUNQO0FBQVMsSUFGVCxVQUErQixLQUEyQjtBQUFLO0FBQzlDO0FBQ0QsWUFBTixhQUFhLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJO0FBQ2hEO0FBQXlCO0FBQXdCO0FBQWEsUUFBdEQsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsS0FBSyxLQUFLLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxFQUEvRCxDQUErRCxFQUN2RTtBQUNULFFBQ1EsSUFBSSxDQUFDLGFBQWEsRUFBRTtBQUM1QixZQUFZLGlEQUFpRDtBQUM3RCxZQUFZLE9BQU8sQ0FBQyxJQUFJLENBQ1IscUJBQ0EsS0FBSyxDQUFDLFFBQVEsa1JBRzBDLENBQzNELENBQUM7QUFDZCxZQUFZLE9BQU87QUFDbkIsU0FBUztBQUNUO0FBQ3FDO0FBQ2IsWUFBVixTQUFTLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDO0FBQ25FLFFBQ1EsSUFBSSxDQUFDLFNBQVMsRUFBRTtBQUN4QixZQUFZLDZCQUE2QjtBQUN6QyxZQUFZLE9BQU8sQ0FBQyxJQUFJLENBQ1IscUJBQ0EsYUFBYSxDQUFDLEVBQUUsdUVBQ29ELENBQ3ZFLENBQUM7QUFDZCxZQUFZLE9BQU87QUFDbkIsU0FBUztBQUNULFFBQ1EsNEJBQTRCO0FBQ3BDLFFBQVEsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDckMsUUFDUSxpQkFBaUI7QUFDekIsUUFBUSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQzVCLFFBQ1EsMEJBQTBCO0FBQ2xDLFFBQVEsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQzNEO0FBQThCLGdCQUFaLFdBQVcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztBQUNwRCxZQUFZLElBQ0ksV0FBVyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFO0FBQ3hELGdCQUFnQixhQUFhLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsRUFDNUM7QUFDZCxnQkFBZ0IsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQy9DLGFBQWE7QUFDYixTQUFTO0FBQ1QsSUFBSSxDQUFDO0FBQ0o7QUFDTztBQUFpQjtBQUEwQjtBQUFvQjtBQUMvRCxJQURJLG9EQUFrQjtBQUFRO0FBQWlCO0FBQzlDO0FBQ1A7QUFBUyxJQUZQLFVBQTJCLE1BQThCO0FBQUssUUFBOUQsaUJBc0RDO0FBQ0wsUUF0RFEsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUU7QUFDeEIsWUFBWSxNQUFNLEtBQUssQ0FDUCxzRUFBc0UsQ0FDekUsQ0FBQztBQUNkLFNBQVM7QUFDVDtBQUN3QixZQUFWLGFBQWEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUM7QUFDakUsUUFDUSxNQUFNLENBQUMsT0FBTztBQUFPO0FBQ047QUFDakI7QUFBYSxRQUZJLFVBQUEsS0FBSztBQUFLO0FBQ007QUFDWCxnQkFBVixPQUFPLEdBQUcsS0FBSSxDQUFDLFVBQVUsRUFBRTtBQUM3QztBQUM2QjtBQUNELGdCQUFWLFNBQVMsR0FBRyxLQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7QUFDaEUsWUFBWSxTQUFTLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNsRCxZQUFZLFNBQVMsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFDcEYsWUFBWSxTQUFTLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDMUQsWUFBWSxxRkFBcUY7QUFDakcsWUFBWSxTQUFTLENBQUMsWUFBWSxDQUNsQixPQUFPLEVBQ1AsMkJBQXlCLEtBQUksQ0FBQyxLQUFLLDJCQUNuQyxLQUFJLENBQUMsY0FBYyxPQUNmLENBQ1AsQ0FBQztBQUNkLFlBQVksU0FBUyxDQUFDLFNBQVMsR0FBRyxLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7QUFDdkQsWUFBWSxTQUFTLENBQUMsZ0JBQWdCLENBQUMsT0FBTztBQUFRO0FBQzdCO0FBQ3pCLFlBRmdEO0FBQzFDLGdCQUFVLEtBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDeEMsWUFBWSxDQUFDLEVBQUMsQ0FBQztBQUNmLFlBQ1ksNkJBQTZCO0FBQ3pDLFlBQVksS0FBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUM7QUFDbkMsZ0JBQWdCLEVBQUUsRUFBRSxPQUFPO0FBQzNCLGdCQUFnQixLQUFLLEVBQUUsS0FBSztBQUM1QixhQUFhLENBQUMsQ0FBQztBQUNmLFlBQ1ksMENBQTBDO0FBQ3RELFlBQVksS0FBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsYUFBYSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQ2hFLFFBQVEsQ0FBQyxFQUFDLENBQUM7QUFDWCxRQUNRLGtCQUFrQjtBQUMxQixRQUFRLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFDNUQ7QUFDMEM7QUFDbEIsWUFBVixPQUFPLEdBQUcsa0JBQWtCLENBQUMsYUFBYSxDQUFDO0FBQ3pELFFBQVEsT0FBTyxDQUFDLEVBQUUsQ0FBQyxVQUFVO0FBQVE7QUFDdkI7QUFDTjtBQUF3QjtBQUFhLFFBRmQsVUFBQyxRQUFRLEVBQUUsS0FBSztBQUFLLFlBQ3hDLElBQUksS0FBSyxDQUFDLFFBQVEsRUFBRTtBQUNoQyxnQkFBZ0IsS0FBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsS0FBSSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDaEUsZ0JBQWdCLGVBQWU7QUFDL0IsZ0JBQWdCLEtBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3RFLGdCQUFnQixLQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDL0MsZ0JBQWdCLEtBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDekMsYUFBYTtBQUNiLFFBQVEsQ0FBQyxFQUFDLENBQUM7QUFDWCxJQUFJLENBQUM7QUFDSjtBQUNPO0FBQWlCO0FBQ25CO0FBQVMsSUFESCwrQ0FBYTtBQUFRO0FBQ3RCO0FBQW9CO0FBQVMsSUFEcEM7QUFBZTtBQUNiLFlBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyx5QkFBeUI7QUFDdEQsUUFDUSxJQUFJLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQy9EO0FBQThCLGdCQUFaLFdBQVcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7QUFDM0QsWUFDWSxTQUFTLElBQUksR0FBRyxHQUFHLFdBQVcsQ0FBQztBQUMzQyxTQUFTO0FBQ1QsUUFDUSxPQUFPLFNBQVMsQ0FBQztBQUN6QixJQUFJLENBQUM7QUFDSjtBQUNPO0FBQWlCO0FBQ2hCO0FBQVMsSUFETiw0Q0FBVTtBQUFRO0FBQ25CO0FBQW9CO0FBQVMsSUFEcEM7QUFBZSxRQUNYLE9BQU8sSUFBSSxDQUFDLFdBQVcsR0FBRyxHQUFHLEdBQUcsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQzVELElBQUksQ0FBQyxDQTVSRztBQUFFO29DQUxULFNBQVMsU0FBQyx0REFLdUI7UUFKOUIsZUFBZSxFQUFFLHpCQU1WLGdCQWpCUCxTQUFTO0FBQ1o7UUFVMkMsQ0FBQyxNQUFNLHVCQUMvQyxRQUFRLDlDQVhBO0FBV0UscUJBQXFCLHJCQVR6Qix5QkFjTCxLQUFLO1FBSk4sUUFBUSxFQUFFLGxCQUlFLHdCQUNYLEtBQUs7ZUFMb0MsbUJBQzdDLGxDQUllLHlCQUNYLEtBQUs7QUFBTSxpQ0FDWCxLQUFLO0FBQU0sK0JBQ1gsS0FBSztBQUFNLDZCQUVYLE1BQU07QUFBTSxpQ0FDWixNQUFNO0FBQU0saUNBQ1osTUFBTTtBQUFLOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQU07QUFBRSxJQW1SeEIsOEJBQUM7QUFDQSxDQURBLEFBbFNELElBa1NDO0FBQ0QsU0E5UmEsdUJBQXVCO0FBQ2pDO0FBQWM7QUFBc0IsSUFDbkMseUNBQTZDO0FBQ2pEO0FBQXNCLElBQWxCLHdDQUE2QjtBQUNqQztBQUFzQixJQUFsQix5Q0FBNEI7QUFDaEM7QUFBc0IsSUFBbEIsaURBQW9DO0FBQ3hDO0FBQXNCLElBQWxCLCtDQUFxQztBQUN6QztBQUNvQixJQUFoQiw2Q0FBZ0U7QUFDcEU7QUFBc0IsSUFBbEIsaURBQXFEO0FBQ3pEO0FBQXNCLElBQWxCLGlEQUFxRDtBQUN6RDtBQUNvQixJQUFoQiw4Q0FBMEQ7QUFDOUQ7QUFDTztBQUFrQjtBQUFpQjtBQUFTLElBQS9DLDREQUE2RTtBQUNqRjtBQUFTO0FBQWtCO0FBQWlCO0FBQVMsSUFBakQsK0NBQWtEO0FBQ3REO0FBQ087QUFBa0I7QUFDVDtBQUNoQixJQUZJLHdDQUFvQjtBQUN4QjtBQUFTO0FBQ1A7QUFBaUI7QUFBUyxJQUR4Qix1Q0FBbUI7QUFDdkI7QUFBUztBQUFrQjtBQUFpQjtBQUN0QyxJQURGLG1EQUF5QztBQUM3QztBQUFTO0FBQWtCO0FBRTFCO0FBQVMsSUFGTiw0Q0FBbUM7QUFDdkM7QUFDTztBQUFrQjtBQUFpQjtBQUN6QyxJQURlLDJDQUEyQjtBQUFFO0FBQUc7QUFFL0M7QUFBWTtBQXVRYiwwQkFHQztBQUNEO0FBQWM7QUFBc0IsSUFIaEMseUJBQVc7QUFDZjtBQUFzQixJQUFsQiw0QkFBNEI7O0FBeFRBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFHQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBMkJBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFwQkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFLQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBTUEsQUFMQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBS0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBc0RBLEFBckRBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBalNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQWRBLEFBQUEsQUFpQkEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFtUkEsQUFBQSxBQUFBLEFBbFNBLEFBa1NBLEFBN1JBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBeVFBLEFBR0EsQUFGQSxBQUFBLEFBQ0EsQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBBZnRlclZpZXdJbml0LFxyXG4gICAgQ29tcG9uZW50LFxyXG4gICAgRXZlbnRFbWl0dGVyLFxyXG4gICAgSW5wdXQsXHJcbiAgICBPbkNoYW5nZXMsXHJcbiAgICBPbkRlc3Ryb3ksXHJcbiAgICBPdXRwdXQsXHJcbiAgICBSZW5kZXJlcjIsXHJcbiAgICBTaW1wbGVDaGFuZ2VzLFxyXG4gICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCBpbWFnZXNMb2FkZWRNZXRob2QgZnJvbSAnaW1hZ2VzbG9hZGVkJztcclxuaW1wb3J0ICogYXMgbWFzb25yeSBmcm9tICdtYXNvbnJ5LWxheW91dCc7XHJcblxyXG5pbXBvcnQgeyBJTWFzb25yeUdhbGxlcnlJbWFnZSB9IGZyb20gJy4vbWFzb25yeS1nYWxsZXJ5LW1vZGVscyc7XHJcbmltcG9ydCB7IHV0aWxpdGllcyB9IGZyb20gJy4vdXRpbGl0aWVzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXHJcbiAgICBzZWxlY3RvcjogJ25neC1tYXNvbnJ5LWdhbGxlcnknLFxyXG4gICAgdGVtcGxhdGU6ICc8ZGl2IFtpZF09XCJnYWxsZXJ5R3VpZFwiPjwvZGl2PidcclxufSlcclxuZXhwb3J0IGNsYXNzIE1hc29ucnlHYWxsZXJ5Q29tcG9uZW50XHJcbiAgICBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcclxuICAgIEBJbnB1dCgpIGltYWdlczogSU1hc29ucnlHYWxsZXJ5SW1hZ2VbXSA9IFtdO1xyXG4gICAgQElucHV0KCkgd2lkdGg6IG51bWJlciA9IDMzMDtcclxuICAgIEBJbnB1dCgpIGd1dHRlcjogbnVtYmVyID0gNTtcclxuICAgIEBJbnB1dCgpIHZlcnRpY2FsR3V0dGVyOiBudW1iZXIgPSA1O1xyXG4gICAgQElucHV0KCkgaW1hZ2VDbGFzc2VzOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICAgIEBPdXRwdXQoKSBjbGlja0ltYWdlID0gbmV3IEV2ZW50RW1pdHRlcjxJTWFzb25yeUdhbGxlcnlJbWFnZT4oKTtcclxuICAgIEBPdXRwdXQoKSByZW1vdmVDb21wbGV0ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55W10+KCk7XHJcbiAgICBAT3V0cHV0KCkgbGF5b3V0Q29tcGxldGUgPSBuZXcgRXZlbnRFbWl0dGVyPGFueVtdPigpO1xyXG5cclxuICAgIHB1YmxpYyByZWFkb25seSBnYWxsZXJ5R3VpZDogc3RyaW5nID0gdXRpbGl0aWVzLm5ld0d1aWQoKTtcclxuXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1hbnNvbnJ5SXRlbVNlbGVjdG9yQ2xhc3MgPSBgZ3JpZC1pdGVtLSR7dGhpcy5nYWxsZXJ5R3VpZH1gO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBhY3RpdmVJbWFnZXM6IEFjdGl2ZUltYWdlW10gPSBbXTtcclxuXHJcbiAgICBwcml2YXRlIG1zbnJ5PzogYW55O1xyXG4gICAgcHJpdmF0ZSBncmlkPzogYW55O1xyXG4gICAgcHJpdmF0ZSBjaGFuZ2VzVG9Qcm9jZXNzPzogU2ltcGxlQ2hhbmdlcztcclxuICAgIHByaXZhdGUgdmlld1JlYWR5OiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyKSB7IH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMuaW1hZ2VzICYmIGNoYW5nZXMuaW1hZ2VzLmN1cnJlbnRWYWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMudmlld1JlYWR5KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBwcm9jZXNzIGltYWdlcyBvbmNlIHdlIGNhblxyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VzVG9Qcm9jZXNzID0gY2hhbmdlcztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0ltYWdlcyhjaGFuZ2VzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5tc25yeSkge1xyXG4gICAgICAgICAgICB0aGlzLm1zbnJ5LmRlc3Ryb3koKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlQ2xpY2soaW1hZ2U6IElNYXNvbnJ5R2FsbGVyeUltYWdlKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jbGlja0ltYWdlLm5leHQoaW1hZ2UpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnZpZXdSZWFkeSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5pbml0TWFzb25yeSgpO1xyXG5cclxuICAgICAgICAvLyBwcm9jZXNzIGltYWdlcyBub3dcclxuICAgICAgICBpZiAodGhpcy5jaGFuZ2VzVG9Qcm9jZXNzKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0ltYWdlcyh0aGlzLmNoYW5nZXNUb1Byb2Nlc3MpO1xyXG4gICAgICAgICAgICB0aGlzLmNoYW5nZXNUb1Byb2Nlc3MgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFkZEltYWdlcyhpbWFnZXM6IElNYXNvbnJ5R2FsbGVyeUltYWdlW10pOiB2b2lkIHtcclxuICAgICAgICBpZiAoaW1hZ2VzICYmIGltYWdlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkSW1hZ2VzVG9HYWxsZXJ5KGltYWdlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUltYWdlcyhpbWFnZXM6IElNYXNvbnJ5R2FsbGVyeUltYWdlW10pOiB2b2lkIHtcclxuICAgICAgICBpZiAoaW1hZ2VzICYmIGltYWdlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGltYWdlcy5mb3JFYWNoKGltYWdlID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSW1hZ2VGcm9tR2FsbGVyeShpbWFnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHByb2Nlc3NJbWFnZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGltYWdlc1RvUHJvY2VzcyA9IHRoaXMuZ2V0QWRkZWRBbmRSZW1vdmVzSW1hZ2VzKGNoYW5nZXMpO1xyXG5cclxuICAgICAgICAvLyBhZGQgaW1hZ2VzIHRvIG1hbnNvbnJ5IGxheW91dFxyXG4gICAgICAgIHRoaXMuYWRkSW1hZ2VzKGltYWdlc1RvUHJvY2Vzcy5hZGRlZEltYWdlcyk7XHJcblxyXG4gICAgICAgIC8vIHJlbW92ZXMgaW1hZ2VzIGZyb20gbGF5b3V0XHJcbiAgICAgICAgdGhpcy5yZW1vdmVJbWFnZXMoaW1hZ2VzVG9Qcm9jZXNzLnJlbW92ZWRJbWFnZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0QWRkZWRBbmRSZW1vdmVzSW1hZ2VzKFxyXG4gICAgICAgIGNoYW5nZXM6IFNpbXBsZUNoYW5nZXNcclxuICAgICk6IHtcclxuICAgICAgICAgICAgYWRkZWRJbWFnZXM6IElNYXNvbnJ5R2FsbGVyeUltYWdlW107XHJcbiAgICAgICAgICAgIHJlbW92ZWRJbWFnZXM6IElNYXNvbnJ5R2FsbGVyeUltYWdlW107XHJcbiAgICAgICAgfSB7XHJcbiAgICAgICAgbGV0IGFkZGVkSW1hZ2VzOiBJTWFzb25yeUdhbGxlcnlJbWFnZVtdID0gW107XHJcbiAgICAgICAgY29uc3QgcmVtb3ZlZEltYWdlczogSU1hc29ucnlHYWxsZXJ5SW1hZ2VbXSA9IFtdO1xyXG5cclxuICAgICAgICBjb25zdCBuZXdJbWFnZXNWYWx1ZSA9IGNoYW5nZXMuaW1hZ2VzXHJcbiAgICAgICAgICAgIC5jdXJyZW50VmFsdWUgYXMgSU1hc29ucnlHYWxsZXJ5SW1hZ2VbXTtcclxuICAgICAgICBjb25zdCBvbGRJbWFnZXNWYWx1ZSA9IGNoYW5nZXMuaW1hZ2VzXHJcbiAgICAgICAgICAgIC5wcmV2aW91c1ZhbHVlIGFzIElNYXNvbnJ5R2FsbGVyeUltYWdlW107XHJcblxyXG4gICAgICAgIGlmICghb2xkSW1hZ2VzVmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gYWxsIGltYWdlcyBhcmUgbmV3IG9uZXNcclxuICAgICAgICAgICAgYWRkZWRJbWFnZXMgPSBjaGFuZ2VzLmltYWdlcy5jdXJyZW50VmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gcHJvY2VzcyBhZGRlZCBpbWFnZXNcclxuICAgICAgICAgICAgbmV3SW1hZ2VzVmFsdWUuZm9yRWFjaChuZXdJbWFnZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0ltYWdlID0gb2xkSW1hZ2VzVmFsdWUuZmluZChcclxuICAgICAgICAgICAgICAgICAgICBtID0+IG0uaW1hZ2VVcmwudG9Mb3dlckNhc2UoKSA9PT0gbmV3SW1hZ2UuaW1hZ2VVcmwudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdJbWFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGltYWdlIHdhcyBpbiBwcmV2aW91cyB2YWx1ZSAmJiBpcyBpbiBuZXcsIGRvIG5vdGhpbmdcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaW1hZ2UgaXMgbmV3XHJcbiAgICAgICAgICAgICAgICAgICAgYWRkZWRJbWFnZXMucHVzaChuZXdJbWFnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gcHJvY2VzcyByZW1vdmVkIGltYWdlc1xyXG4gICAgICAgICAgICBvbGRJbWFnZXNWYWx1ZS5mb3JFYWNoKG9sZEltYWdlID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSW1hZ2UgPSBuZXdJbWFnZXNWYWx1ZS5maW5kKFxyXG4gICAgICAgICAgICAgICAgICAgIG0gPT4gbS5pbWFnZVVybC50b0xvd2VyQ2FzZSgpID09PSBvbGRJbWFnZS5pbWFnZVVybC50b0xvd2VyQ2FzZSgpXHJcbiAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ0ltYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaW1hZ2Ugd2FzIGluIHByZXZpb3VzIHZhbHVlICYmIGlzIGluIG5ldywgZG8gbm90aGluZ1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpbWFnZSBpcyByZW1vdmVkXHJcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZEltYWdlcy5wdXNoKG9sZEltYWdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhZGRlZEltYWdlczogYWRkZWRJbWFnZXMsXHJcbiAgICAgICAgICAgIHJlbW92ZWRJbWFnZXM6IHJlbW92ZWRJbWFnZXNcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdE1hc29ucnkoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5ncmlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5nYWxsZXJ5R3VpZCk7XHJcblxyXG4gICAgICAgIC8vIHJlbW92ZSBhbGwgZXhpc3RpbmcgZGF0YSBmcm9tIGdyaWRcclxuICAgICAgICB0aGlzLmdyaWQuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5ncmlkKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFxyXG4gICAgICAgICAgICAgICAgYENvdWxkIG5vdCBpbml0IG1hbnNvcnkgZHVlIHRvIG5vbiBleGlzdGluZyBlbGVtIHdpdGggaWQgJyR7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdhbGxlcnlHdWlkXHJcbiAgICAgICAgICAgICAgICB9J2BcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubXNucnkgPSBuZXcgbWFzb25yeSh0aGlzLmdyaWQsIHtcclxuICAgICAgICAgICAgLy8gb3B0aW9ucy4uLlxyXG4gICAgICAgICAgICBpdGVtU2VsZWN0b3I6ICcuJyArIHRoaXMubWFuc29ucnlJdGVtU2VsZWN0b3JDbGFzcyxcclxuICAgICAgICAgICAgY29sdW1uV2lkdGg6IHRoaXMud2lkdGgsXHJcbiAgICAgICAgICAgIGd1dHRlcjogdGhpcy5ndXR0ZXIsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aGlzLm1zbnJ5Lm9uKCdsYXlvdXRDb21wbGV0ZScsIGZ1bmN0aW9uIChpdGVtcykge1xyXG4gICAgICAgICAgICB0aGF0LmxheW91dENvbXBsZXRlLm5leHQoaXRlbXMpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLm1zbnJ5Lm9uKCdyZW1vdmVDb21wbGV0ZScsIGZ1bmN0aW9uIChpdGVtcykge1xyXG4gICAgICAgICAgICB0aGF0LnJlbW92ZUNvbXBsZXRlLm5leHQoaXRlbXMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlSW1hZ2VGcm9tR2FsbGVyeShpbWFnZTogSU1hc29ucnlHYWxsZXJ5SW1hZ2UpOiB2b2lkIHtcclxuICAgICAgICAvLyBnZXQgaW1hZ2UgZ3VpZFxyXG4gICAgICAgIGNvbnN0IGltYWdlSWRSZXN1bHQgPSB0aGlzLmFjdGl2ZUltYWdlcy5maW5kKFxyXG4gICAgICAgICAgICBtID0+IG0uaW1hZ2UuaW1hZ2VVcmwudG9Mb3dlckNhc2UoKSA9PT0gaW1hZ2UuaW1hZ2VVcmwudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmICghaW1hZ2VJZFJlc3VsdCkge1xyXG4gICAgICAgICAgICAvLyBpbWFnZSB3YXMgbm90IGZvdW5kLCB0aGlzIGlzIHByb2JhYmx5IGFuIGVycm9yXHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcclxuICAgICAgICAgICAgICAgIGBJbWFnZSB3aXRoIHVybCAnJHtcclxuICAgICAgICAgICAgICAgIGltYWdlLmltYWdlVXJsXHJcbiAgICAgICAgICAgICAgICB9JyB3YXMgbm90IGZvdW5kLiBJZiB5b3UgYXJlIGFkZGluZyBpbWFnZXMsIG1ha2Ugc3VyZSB0byAncmVwbGFjZScgdGhlIGltYWdlcyBhcnJheSB3aXRoIGEgbmV3IG9uZVxyXG4gICAgICAgICAgICAgICAgc28gdGhhdCBkZXRlY3Rpb24gY2hhbmdlIGNhbiBiZSBleGVjdXRlZCBpbnN0ZWFkIG9mIGp1c3QgYWRkaW5nIGFuIGltYWdlIHRvIGFycmF5XHJcbiAgICAgICAgICAgICAgICAod2hpY2ggZG9lc24ndCBmaXJlIGNoYW5nZSBkZXRlY3Rpb24gb24gYXJyYXkgcHJvcGVydHkpYFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBmaW5kIGltYWdlIGJhc2VkIG9uIGl0cyBpZFxyXG4gICAgICAgIGNvbnN0IGltYWdlRWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGltYWdlSWRSZXN1bHQuaWQpO1xyXG5cclxuICAgICAgICBpZiAoIWltYWdlRWxlbSkge1xyXG4gICAgICAgICAgICAvLyBpbWFnZSB3YXMgbm90IGZvdW5kIGluIERPTVxyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXHJcbiAgICAgICAgICAgICAgICBgSW1hZ2Ugd2l0aCBpZCAneyR7XHJcbiAgICAgICAgICAgICAgICBpbWFnZUlkUmVzdWx0LmlkXHJcbiAgICAgICAgICAgICAgICB9fScgd2FzIG5vdCBmb3VuZCBpbiBET00uIEhhdmUgeW91IG1hbmlwdWxhdGVkIHRoZSBET00gaW4gc29tZSB3YXk/YFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyByZW1vdmUgaW1hZ2UgZnJvbSBnYWxsZXJ5XHJcbiAgICAgICAgdGhpcy5tc25yeS5yZW1vdmUoaW1hZ2VFbGVtKTtcclxuXHJcbiAgICAgICAgLy8gcmVmcmVzaCBsYXlvdXRcclxuICAgICAgICB0aGlzLm1zbnJ5LmxheW91dCgpO1xyXG5cclxuICAgICAgICAvLyByZW1vdmUgaW1hZ2UgZnJvbSBhcnJheVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hY3RpdmVJbWFnZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgaWRXaXRoSW1hZ2UgPSB0aGlzLmFjdGl2ZUltYWdlc1tpXTtcclxuICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgaWRXaXRoSW1hZ2UuaW1hZ2UuaW1hZ2VVcmwudG9Mb3dlckNhc2UoKSA9PT1cclxuICAgICAgICAgICAgICAgIGltYWdlSWRSZXN1bHQuaW1hZ2UuaW1hZ2VVcmwudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlSW1hZ2VzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFkZEltYWdlc1RvR2FsbGVyeShpbWFnZXM6IElNYXNvbnJ5R2FsbGVyeUltYWdlW10pOiB2b2lkIHtcclxuICAgICAgICBpZiAoIXRoaXMuZ3JpZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcclxuICAgICAgICAgICAgICAgICdHcmlkIGVsZW1lbnQgaXMgbm90IHlldCByZWFkeSwgYXJlIHlvdSB0cnlpbmcgdG8gYWRkIGltYWdlIHRvbyBzb29uPydcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGltYWdlc1dyYXBwZXIgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcclxuXHJcbiAgICAgICAgaW1hZ2VzLmZvckVhY2goaW1hZ2UgPT4ge1xyXG4gICAgICAgICAgICAvLyBnZW5lcmF0ZSB1bmlxdWUgaW1hZ2UgaWRcclxuICAgICAgICAgICAgY29uc3QgaW1hZ2VJZCA9IHRoaXMuZ2V0SW1hZ2VJZCgpO1xyXG5cclxuICAgICAgICAgICAgLy8gY3JlYXRlIGVsZW1lbnRcclxuICAgICAgICAgICAgY29uc3QgaW1hZ2VFbGVtID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgICAgICAgaW1hZ2VFbGVtLnNldEF0dHJpYnV0ZSgnaWQnLCBpbWFnZUlkKTtcclxuICAgICAgICAgICAgaW1hZ2VFbGVtLnNldEF0dHJpYnV0ZSgnYWx0JywgaW1hZ2UuYWx0ID8gaW1hZ2UuYWx0IDogJ25vIGRlc2NyaXB0aW9uJyk7XHJcbiAgICAgICAgICAgIGltYWdlRWxlbS5zZXRBdHRyaWJ1dGUoJ3NyYycsIGltYWdlLmltYWdlVXJsKTtcclxuICAgICAgICAgICAgLy8gbm90ZSAtIGltYWdlcyBhcmUgaGlkZGVuIGJ5IGRlZmF1bHQgYW5kIHNob3VsZCBiZSBzaG93biBvbmx5IGFmdGVyIHRoZXkgYXJlIGxvYWRlZFxyXG4gICAgICAgICAgICBpbWFnZUVsZW0uc2V0QXR0cmlidXRlKFxyXG4gICAgICAgICAgICAgICAgJ3N0eWxlJyxcclxuICAgICAgICAgICAgICAgIGBkaXNwbGF5OiBub25lOyB3aWR0aDogJHt0aGlzLndpZHRofXB4OyBtYXJnaW4tYm90dG9tOiAke1xyXG4gICAgICAgICAgICAgICAgdGhpcy52ZXJ0aWNhbEd1dHRlclxyXG4gICAgICAgICAgICAgICAgfXB4YFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBpbWFnZUVsZW0uY2xhc3NOYW1lID0gdGhpcy5nZXRJbWFnZUNsYXNzKCk7XHJcbiAgICAgICAgICAgIGltYWdlRWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ2xpY2soaW1hZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIHN0b3JlIGd1aWQgd2l0aCB0aGlzIGltYWdlXHJcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlSW1hZ2VzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgaWQ6IGltYWdlSWQsXHJcbiAgICAgICAgICAgICAgICBpbWFnZTogaW1hZ2VcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBhZGQgdG8gZG9tIGFuZCBtYW5zb3J5ICYgcmVmcmVzaCBsYXlvdXRcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChpbWFnZXNXcmFwcGVyLCBpbWFnZUVsZW0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBhZGQgaHRtbCB0byBkb21cclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuZ3JpZCwgaW1hZ2VzV3JhcHBlcik7XHJcblxyXG4gICAgICAgIC8vIGFkZCBpbWFnZXMgb25jZSB0aGV5IGFyZSBsb2FkZWRcclxuICAgICAgICBjb25zdCBpbWdMb2FkID0gaW1hZ2VzTG9hZGVkTWV0aG9kKGltYWdlc1dyYXBwZXIpO1xyXG4gICAgICAgIGltZ0xvYWQub24oJ3Byb2dyZXNzJywgKGluc3RhbmNlLCBpbWFnZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaW1hZ2UuaXNMb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5ncmlkLCBpbWFnZS5pbWcpO1xyXG4gICAgICAgICAgICAgICAgLy8gdW5oaWRlIGltYWdlXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGltYWdlLmltZywgJ2Rpc3BsYXknLCAnYmxvY2snKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubXNucnkuYXBwZW5kZWQoaW1hZ2UuaW1nKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubXNucnkucmVsb2FkSXRlbXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0SW1hZ2VDbGFzcygpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBjbGFzc05hbWUgPSB0aGlzLm1hbnNvbnJ5SXRlbVNlbGVjdG9yQ2xhc3M7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmltYWdlQ2xhc3NlcyAmJiB0aGlzLmltYWdlQ2xhc3Nlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbUNsYXNzID0gdGhpcy5pbWFnZUNsYXNzZXMuam9pbignICcpO1xyXG5cclxuICAgICAgICAgICAgY2xhc3NOYW1lICs9ICcgJyArIGN1c3RvbUNsYXNzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNsYXNzTmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEltYWdlSWQoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nYWxsZXJ5R3VpZCArICdfJyArIHV0aWxpdGllcy5uZXdHdWlkKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmludGVyZmFjZSBBY3RpdmVJbWFnZSB7XHJcbiAgICBpZDogc3RyaW5nO1xyXG4gICAgaW1hZ2U6IElNYXNvbnJ5R2FsbGVyeUltYWdlO1xyXG59XHJcbiJdfQ==
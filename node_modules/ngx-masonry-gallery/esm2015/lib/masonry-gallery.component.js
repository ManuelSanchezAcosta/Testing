/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output, Renderer2, ChangeDetectionStrategy, } from '@angular/core';
import imagesLoadedMethod from 'imagesloaded';
import * as masonry from 'masonry-layout';
import { utilities } from './utilities';
import * as ɵngcc0 from '@angular/core';
export class MasonryGalleryComponent {
    /**
     * @param {?} renderer
     */
    constructor(renderer) {
        this.renderer = renderer;
        this.images = [];
        this.width = 330;
        this.gutter = 5;
        this.verticalGutter = 5;
        this.imageClasses = [];
        this.clickImage = new EventEmitter();
        this.removeComplete = new EventEmitter();
        this.layoutComplete = new EventEmitter();
        this.galleryGuid = utilities.newGuid();
        this.mansonryItemSelectorClass = `grid-item-${this.galleryGuid}`;
        this.activeImages = [];
        this.viewReady = false;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.images && changes.images.currentValue) {
            if (!this.viewReady) {
                // process images once we can
                this.changesToProcess = changes;
            }
            else {
                this.processImages(changes);
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.msnry) {
            this.msnry.destroy();
        }
    }
    /**
     * @param {?} image
     * @return {?}
     */
    handleClick(image) {
        this.clickImage.next(image);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.viewReady = true;
        this.initMasonry();
        // process images now
        if (this.changesToProcess) {
            this.processImages(this.changesToProcess);
            this.changesToProcess = undefined;
        }
    }
    /**
     * @param {?} images
     * @return {?}
     */
    addImages(images) {
        if (images && images.length > 0) {
            this.addImagesToGallery(images);
        }
    }
    /**
     * @param {?} images
     * @return {?}
     */
    removeImages(images) {
        if (images && images.length > 0) {
            images.forEach((/**
             * @param {?} image
             * @return {?}
             */
            image => {
                this.removeImageFromGallery(image);
            }));
        }
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    processImages(changes) {
        /** @type {?} */
        const imagesToProcess = this.getAddedAndRemovesImages(changes);
        // add images to mansonry layout
        this.addImages(imagesToProcess.addedImages);
        // removes images from layout
        this.removeImages(imagesToProcess.removedImages);
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    getAddedAndRemovesImages(changes) {
        /** @type {?} */
        let addedImages = [];
        /** @type {?} */
        const removedImages = [];
        /** @type {?} */
        const newImagesValue = (/** @type {?} */ (changes.images
            .currentValue));
        /** @type {?} */
        const oldImagesValue = (/** @type {?} */ (changes.images
            .previousValue));
        if (!oldImagesValue) {
            // all images are new ones
            addedImages = changes.images.currentValue;
        }
        else {
            // process added images
            newImagesValue.forEach((/**
             * @param {?} newImage
             * @return {?}
             */
            newImage => {
                /** @type {?} */
                const existingImage = oldImagesValue.find((/**
                 * @param {?} m
                 * @return {?}
                 */
                m => m.imageUrl.toLowerCase() === newImage.imageUrl.toLowerCase()));
                if (existingImage) {
                    // image was in previous value && is in new, do nothing
                }
                else {
                    // image is new
                    addedImages.push(newImage);
                }
            }));
            // process removed images
            oldImagesValue.forEach((/**
             * @param {?} oldImage
             * @return {?}
             */
            oldImage => {
                /** @type {?} */
                const existingImage = newImagesValue.find((/**
                 * @param {?} m
                 * @return {?}
                 */
                m => m.imageUrl.toLowerCase() === oldImage.imageUrl.toLowerCase()));
                if (existingImage) {
                    // image was in previous value && is in new, do nothing
                }
                else {
                    // image is removed
                    removedImages.push(oldImage);
                }
            }));
        }
        return {
            addedImages: addedImages,
            removedImages: removedImages
        };
    }
    /**
     * @private
     * @return {?}
     */
    initMasonry() {
        this.grid = document.getElementById(this.galleryGuid);
        // remove all existing data from grid
        this.grid.innerHTML = '';
        if (!this.grid) {
            throw Error(`Could not init mansory due to non existing elem with id '${this.galleryGuid}'`);
        }
        this.msnry = new masonry(this.grid, {
            // options...
            itemSelector: '.' + this.mansonryItemSelectorClass,
            columnWidth: this.width,
            gutter: this.gutter,
        });
        /** @type {?} */
        const that = this;
        this.msnry.on('layoutComplete', (/**
         * @param {?} items
         * @return {?}
         */
        function (items) {
            that.layoutComplete.next(items);
        }));
        this.msnry.on('removeComplete', (/**
         * @param {?} items
         * @return {?}
         */
        function (items) {
            that.removeComplete.next(items);
        }));
    }
    /**
     * @private
     * @param {?} image
     * @return {?}
     */
    removeImageFromGallery(image) {
        // get image guid
        /** @type {?} */
        const imageIdResult = this.activeImages.find((/**
         * @param {?} m
         * @return {?}
         */
        m => m.image.imageUrl.toLowerCase() === image.imageUrl.toLowerCase()));
        if (!imageIdResult) {
            // image was not found, this is probably an error
            console.warn(`Image with url '${image.imageUrl}' was not found. If you are adding images, make sure to 'replace' the images array with a new one
                so that detection change can be executed instead of just adding an image to array
                (which doesn't fire change detection on array property)`);
            return;
        }
        // find image based on its id
        /** @type {?} */
        const imageElem = document.getElementById(imageIdResult.id);
        if (!imageElem) {
            // image was not found in DOM
            console.warn(`Image with id '{${imageIdResult.id}}' was not found in DOM. Have you manipulated the DOM in some way?`);
            return;
        }
        // remove image from gallery
        this.msnry.remove(imageElem);
        // refresh layout
        this.msnry.layout();
        // remove image from array
        for (let i = 0; i < this.activeImages.length; i++) {
            /** @type {?} */
            const idWithImage = this.activeImages[i];
            if (idWithImage.image.imageUrl.toLowerCase() ===
                imageIdResult.image.imageUrl.toLowerCase()) {
                this.activeImages.splice(i, 1);
            }
        }
    }
    /**
     * @private
     * @param {?} images
     * @return {?}
     */
    addImagesToGallery(images) {
        if (!this.grid) {
            throw Error('Grid element is not yet ready, are you trying to add image too soon?');
        }
        /** @type {?} */
        const imagesWrapper = this.renderer.createElement('span');
        images.forEach((/**
         * @param {?} image
         * @return {?}
         */
        image => {
            // generate unique image id
            /** @type {?} */
            const imageId = this.getImageId();
            // create element
            /** @type {?} */
            const imageElem = this.renderer.createElement('img');
            imageElem.setAttribute('id', imageId);
            imageElem.setAttribute('alt', image.alt ? image.alt : 'no description');
            imageElem.setAttribute('src', image.imageUrl);
            // note - images are hidden by default and should be shown only after they are loaded
            imageElem.setAttribute('style', `display: none; width: ${this.width}px; margin-bottom: ${this.verticalGutter}px`);
            imageElem.className = this.getImageClass();
            imageElem.addEventListener('click', (/**
             * @return {?}
             */
            () => {
                this.handleClick(image);
            }));
            // store guid with this image
            this.activeImages.push({
                id: imageId,
                image: image
            });
            // add to dom and mansory & refresh layout
            this.renderer.appendChild(imagesWrapper, imageElem);
        }));
        // add html to dom
        this.renderer.appendChild(this.grid, imagesWrapper);
        // add images once they are loaded
        /** @type {?} */
        const imgLoad = imagesLoadedMethod(imagesWrapper);
        imgLoad.on('progress', (/**
         * @param {?} instance
         * @param {?} image
         * @return {?}
         */
        (instance, image) => {
            if (image.isLoaded) {
                this.renderer.appendChild(this.grid, image.img);
                // unhide image
                this.renderer.setStyle(image.img, 'display', 'block');
                this.msnry.appended(image.img);
                this.msnry.reloadItems();
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    getImageClass() {
        /** @type {?} */
        let className = this.mansonryItemSelectorClass;
        if (this.imageClasses && this.imageClasses.length > 0) {
            /** @type {?} */
            const customClass = this.imageClasses.join(' ');
            className += ' ' + customClass;
        }
        return className;
    }
    /**
     * @private
     * @return {?}
     */
    getImageId() {
        return this.galleryGuid + '_' + utilities.newGuid();
    }
}
MasonryGalleryComponent.ɵfac = function MasonryGalleryComponent_Factory(t) { return new (t || MasonryGalleryComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2)); };
MasonryGalleryComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: MasonryGalleryComponent, selectors: [["ngx-masonry-gallery"]], inputs: { images: "images", width: "width", gutter: "gutter", verticalGutter: "verticalGutter", imageClasses: "imageClasses" }, outputs: { clickImage: "clickImage", removeComplete: "removeComplete", layoutComplete: "layoutComplete" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 1, vars: 1, consts: [[3, "id"]], template: function MasonryGalleryComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelement(0, "div", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("id", ctx.galleryGuid);
    } }, encapsulation: 2, changeDetection: 0 });
/** @nocollapse */
MasonryGalleryComponent.ctorParameters = () => [
    { type: Renderer2 }
];
MasonryGalleryComponent.propDecorators = {
    images: [{ type: Input }],
    width: [{ type: Input }],
    gutter: [{ type: Input }],
    verticalGutter: [{ type: Input }],
    imageClasses: [{ type: Input }],
    clickImage: [{ type: Output }],
    removeComplete: [{ type: Output }],
    layoutComplete: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(MasonryGalleryComponent, [{
        type: Component,
        args: [{
                changeDetection: ChangeDetectionStrategy.OnPush,
                selector: 'ngx-masonry-gallery',
                template: '<div [id]="galleryGuid"></div>'
            }]
    }], function () { return [{ type: ɵngcc0.Renderer2 }]; }, { images: [{
            type: Input
        }], width: [{
            type: Input
        }], gutter: [{
            type: Input
        }], verticalGutter: [{
            type: Input
        }], imageClasses: [{
            type: Input
        }], clickImage: [{
            type: Output
        }], removeComplete: [{
            type: Output
        }], layoutComplete: [{
            type: Output
        }] }); })();
if (false) {
    /** @type {?} */
    MasonryGalleryComponent.prototype.images;
    /** @type {?} */
    MasonryGalleryComponent.prototype.width;
    /** @type {?} */
    MasonryGalleryComponent.prototype.gutter;
    /** @type {?} */
    MasonryGalleryComponent.prototype.verticalGutter;
    /** @type {?} */
    MasonryGalleryComponent.prototype.imageClasses;
    /** @type {?} */
    MasonryGalleryComponent.prototype.clickImage;
    /** @type {?} */
    MasonryGalleryComponent.prototype.removeComplete;
    /** @type {?} */
    MasonryGalleryComponent.prototype.layoutComplete;
    /** @type {?} */
    MasonryGalleryComponent.prototype.galleryGuid;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.mansonryItemSelectorClass;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.activeImages;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.msnry;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.grid;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.changesToProcess;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.viewReady;
    /**
     * @type {?}
     * @private
     */
    MasonryGalleryComponent.prototype.renderer;
}
/**
 * @record
 */
function ActiveImage() { }
if (false) {
    /** @type {?} */
    ActiveImage.prototype.id;
    /** @type {?} */
    ActiveImage.prototype.image;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFzb25yeS1nYWxsZXJ5LmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsibmd4LW1hc29ucnktZ2FsbGVyeS9saWIvbWFzb25yeS1nYWxsZXJ5LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUVILFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUdMLE1BQU0sRUFDTixTQUFTLEVBRVQsdUJBQXVCLEdBQzFCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sa0JBQWtCLE1BQU0sY0FBYyxDQUFDO0FBQzlDLE9BQU8sS0FBSyxPQUFPLE1BQU0sZ0JBQWdCLENBQUM7QUFHMUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGFBQWEsQ0FBQzs7QUFPeEMsTUFBTSxPQUFPLHVCQUF1QjtBQUNsQztBQUFTO0FBQTRCO0FBQVMsSUFxQjVDLFlBQW9CLFFBQW1CO0FBQUssUUFBeEIsYUFBUSxHQUFSLFFBQVEsQ0FBVztBQUFFLFFBcEJoQyxXQUFNLEdBQTJCLEVBQUUsQ0FBQztBQUNqRCxRQUFhLFVBQUssR0FBVyxHQUFHLENBQUM7QUFDakMsUUFBYSxXQUFNLEdBQVcsQ0FBQyxDQUFDO0FBQ2hDLFFBQWEsbUJBQWMsR0FBVyxDQUFDLENBQUM7QUFDeEMsUUFBYSxpQkFBWSxHQUFhLEVBQUUsQ0FBQztBQUN6QyxRQUNjLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBd0IsQ0FBQztBQUNwRSxRQUFjLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQVMsQ0FBQztBQUN6RCxRQUFjLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQVMsQ0FBQztBQUN6RCxRQUNvQixnQkFBVyxHQUFXLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUM5RCxRQUNxQiw4QkFBeUIsR0FBRyxhQUFhLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUNqRixRQUFxQixpQkFBWSxHQUFrQixFQUFFLENBQUM7QUFDdEQsUUFJWSxjQUFTLEdBQVksS0FBSyxDQUFDO0FB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LEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBS0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQWpTQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFkQSxBQUFBLEFBaUJBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBUkEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQXlRQSxBQUdBLEFBRkEsQUFBQSxBQUNBLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgQWZ0ZXJWaWV3SW5pdCxcclxuICAgIENvbXBvbmVudCxcclxuICAgIEV2ZW50RW1pdHRlcixcclxuICAgIElucHV0LFxyXG4gICAgT25DaGFuZ2VzLFxyXG4gICAgT25EZXN0cm95LFxyXG4gICAgT3V0cHV0LFxyXG4gICAgUmVuZGVyZXIyLFxyXG4gICAgU2ltcGxlQ2hhbmdlcyxcclxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgaW1hZ2VzTG9hZGVkTWV0aG9kIGZyb20gJ2ltYWdlc2xvYWRlZCc7XHJcbmltcG9ydCAqIGFzIG1hc29ucnkgZnJvbSAnbWFzb25yeS1sYXlvdXQnO1xyXG5cclxuaW1wb3J0IHsgSU1hc29ucnlHYWxsZXJ5SW1hZ2UgfSBmcm9tICcuL21hc29ucnktZ2FsbGVyeS1tb2RlbHMnO1xyXG5pbXBvcnQgeyB1dGlsaXRpZXMgfSBmcm9tICcuL3V0aWxpdGllcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG4gICAgc2VsZWN0b3I6ICduZ3gtbWFzb25yeS1nYWxsZXJ5JyxcclxuICAgIHRlbXBsYXRlOiAnPGRpdiBbaWRdPVwiZ2FsbGVyeUd1aWRcIj48L2Rpdj4nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBNYXNvbnJ5R2FsbGVyeUNvbXBvbmVudFxyXG4gICAgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XHJcbiAgICBASW5wdXQoKSBpbWFnZXM6IElNYXNvbnJ5R2FsbGVyeUltYWdlW10gPSBbXTtcclxuICAgIEBJbnB1dCgpIHdpZHRoOiBudW1iZXIgPSAzMzA7XHJcbiAgICBASW5wdXQoKSBndXR0ZXI6IG51bWJlciA9IDU7XHJcbiAgICBASW5wdXQoKSB2ZXJ0aWNhbEd1dHRlcjogbnVtYmVyID0gNTtcclxuICAgIEBJbnB1dCgpIGltYWdlQ2xhc3Nlczogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICBAT3V0cHV0KCkgY2xpY2tJbWFnZSA9IG5ldyBFdmVudEVtaXR0ZXI8SU1hc29ucnlHYWxsZXJ5SW1hZ2U+KCk7XHJcbiAgICBAT3V0cHV0KCkgcmVtb3ZlQ29tcGxldGUgPSBuZXcgRXZlbnRFbWl0dGVyPGFueVtdPigpO1xyXG4gICAgQE91dHB1dCgpIGxheW91dENvbXBsZXRlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnlbXT4oKTtcclxuXHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgZ2FsbGVyeUd1aWQ6IHN0cmluZyA9IHV0aWxpdGllcy5uZXdHdWlkKCk7XHJcblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBtYW5zb25yeUl0ZW1TZWxlY3RvckNsYXNzID0gYGdyaWQtaXRlbS0ke3RoaXMuZ2FsbGVyeUd1aWR9YDtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgYWN0aXZlSW1hZ2VzOiBBY3RpdmVJbWFnZVtdID0gW107XHJcblxyXG4gICAgcHJpdmF0ZSBtc25yeT86IGFueTtcclxuICAgIHByaXZhdGUgZ3JpZD86IGFueTtcclxuICAgIHByaXZhdGUgY2hhbmdlc1RvUHJvY2Vzcz86IFNpbXBsZUNoYW5nZXM7XHJcbiAgICBwcml2YXRlIHZpZXdSZWFkeTogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikgeyB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLmltYWdlcyAmJiBjaGFuZ2VzLmltYWdlcy5jdXJyZW50VmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnZpZXdSZWFkeSkge1xyXG4gICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBpbWFnZXMgb25jZSB3ZSBjYW5cclxuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlc1RvUHJvY2VzcyA9IGNoYW5nZXM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NJbWFnZXMoY2hhbmdlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMubXNucnkpIHtcclxuICAgICAgICAgICAgdGhpcy5tc25yeS5kZXN0cm95KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZUNsaWNrKGltYWdlOiBJTWFzb25yeUdhbGxlcnlJbWFnZSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY2xpY2tJbWFnZS5uZXh0KGltYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy52aWV3UmVhZHkgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuaW5pdE1hc29ucnkoKTtcclxuXHJcbiAgICAgICAgLy8gcHJvY2VzcyBpbWFnZXMgbm93XHJcbiAgICAgICAgaWYgKHRoaXMuY2hhbmdlc1RvUHJvY2Vzcykge1xyXG4gICAgICAgICAgICB0aGlzLnByb2Nlc3NJbWFnZXModGhpcy5jaGFuZ2VzVG9Qcm9jZXNzKTtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VzVG9Qcm9jZXNzID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhZGRJbWFnZXMoaW1hZ2VzOiBJTWFzb25yeUdhbGxlcnlJbWFnZVtdKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGltYWdlcyAmJiBpbWFnZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmFkZEltYWdlc1RvR2FsbGVyeShpbWFnZXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVJbWFnZXMoaW1hZ2VzOiBJTWFzb25yeUdhbGxlcnlJbWFnZVtdKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGltYWdlcyAmJiBpbWFnZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBpbWFnZXMuZm9yRWFjaChpbWFnZSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUltYWdlRnJvbUdhbGxlcnkoaW1hZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBwcm9jZXNzSW1hZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBpbWFnZXNUb1Byb2Nlc3MgPSB0aGlzLmdldEFkZGVkQW5kUmVtb3Zlc0ltYWdlcyhjaGFuZ2VzKTtcclxuXHJcbiAgICAgICAgLy8gYWRkIGltYWdlcyB0byBtYW5zb25yeSBsYXlvdXRcclxuICAgICAgICB0aGlzLmFkZEltYWdlcyhpbWFnZXNUb1Byb2Nlc3MuYWRkZWRJbWFnZXMpO1xyXG5cclxuICAgICAgICAvLyByZW1vdmVzIGltYWdlcyBmcm9tIGxheW91dFxyXG4gICAgICAgIHRoaXMucmVtb3ZlSW1hZ2VzKGltYWdlc1RvUHJvY2Vzcy5yZW1vdmVkSW1hZ2VzKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEFkZGVkQW5kUmVtb3Zlc0ltYWdlcyhcclxuICAgICAgICBjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzXHJcbiAgICApOiB7XHJcbiAgICAgICAgICAgIGFkZGVkSW1hZ2VzOiBJTWFzb25yeUdhbGxlcnlJbWFnZVtdO1xyXG4gICAgICAgICAgICByZW1vdmVkSW1hZ2VzOiBJTWFzb25yeUdhbGxlcnlJbWFnZVtdO1xyXG4gICAgICAgIH0ge1xyXG4gICAgICAgIGxldCBhZGRlZEltYWdlczogSU1hc29ucnlHYWxsZXJ5SW1hZ2VbXSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IHJlbW92ZWRJbWFnZXM6IElNYXNvbnJ5R2FsbGVyeUltYWdlW10gPSBbXTtcclxuXHJcbiAgICAgICAgY29uc3QgbmV3SW1hZ2VzVmFsdWUgPSBjaGFuZ2VzLmltYWdlc1xyXG4gICAgICAgICAgICAuY3VycmVudFZhbHVlIGFzIElNYXNvbnJ5R2FsbGVyeUltYWdlW107XHJcbiAgICAgICAgY29uc3Qgb2xkSW1hZ2VzVmFsdWUgPSBjaGFuZ2VzLmltYWdlc1xyXG4gICAgICAgICAgICAucHJldmlvdXNWYWx1ZSBhcyBJTWFzb25yeUdhbGxlcnlJbWFnZVtdO1xyXG5cclxuICAgICAgICBpZiAoIW9sZEltYWdlc1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vIGFsbCBpbWFnZXMgYXJlIG5ldyBvbmVzXHJcbiAgICAgICAgICAgIGFkZGVkSW1hZ2VzID0gY2hhbmdlcy5pbWFnZXMuY3VycmVudFZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHByb2Nlc3MgYWRkZWQgaW1hZ2VzXHJcbiAgICAgICAgICAgIG5ld0ltYWdlc1ZhbHVlLmZvckVhY2gobmV3SW1hZ2UgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdJbWFnZSA9IG9sZEltYWdlc1ZhbHVlLmZpbmQoXHJcbiAgICAgICAgICAgICAgICAgICAgbSA9PiBtLmltYWdlVXJsLnRvTG93ZXJDYXNlKCkgPT09IG5ld0ltYWdlLmltYWdlVXJsLnRvTG93ZXJDYXNlKClcclxuICAgICAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nSW1hZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpbWFnZSB3YXMgaW4gcHJldmlvdXMgdmFsdWUgJiYgaXMgaW4gbmV3LCBkbyBub3RoaW5nXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGltYWdlIGlzIG5ld1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZGVkSW1hZ2VzLnB1c2gobmV3SW1hZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIHByb2Nlc3MgcmVtb3ZlZCBpbWFnZXNcclxuICAgICAgICAgICAgb2xkSW1hZ2VzVmFsdWUuZm9yRWFjaChvbGRJbWFnZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0ltYWdlID0gbmV3SW1hZ2VzVmFsdWUuZmluZChcclxuICAgICAgICAgICAgICAgICAgICBtID0+IG0uaW1hZ2VVcmwudG9Mb3dlckNhc2UoKSA9PT0gb2xkSW1hZ2UuaW1hZ2VVcmwudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdJbWFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGltYWdlIHdhcyBpbiBwcmV2aW91cyB2YWx1ZSAmJiBpcyBpbiBuZXcsIGRvIG5vdGhpbmdcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaW1hZ2UgaXMgcmVtb3ZlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZWRJbWFnZXMucHVzaChvbGRJbWFnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgYWRkZWRJbWFnZXM6IGFkZGVkSW1hZ2VzLFxyXG4gICAgICAgICAgICByZW1vdmVkSW1hZ2VzOiByZW1vdmVkSW1hZ2VzXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRNYXNvbnJ5KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuZ2FsbGVyeUd1aWQpO1xyXG5cclxuICAgICAgICAvLyByZW1vdmUgYWxsIGV4aXN0aW5nIGRhdGEgZnJvbSBncmlkXHJcbiAgICAgICAgdGhpcy5ncmlkLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZ3JpZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcclxuICAgICAgICAgICAgICAgIGBDb3VsZCBub3QgaW5pdCBtYW5zb3J5IGR1ZSB0byBub24gZXhpc3RpbmcgZWxlbSB3aXRoIGlkICcke1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nYWxsZXJ5R3VpZFxyXG4gICAgICAgICAgICAgICAgfSdgXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLm1zbnJ5ID0gbmV3IG1hc29ucnkodGhpcy5ncmlkLCB7XHJcbiAgICAgICAgICAgIC8vIG9wdGlvbnMuLi5cclxuICAgICAgICAgICAgaXRlbVNlbGVjdG9yOiAnLicgKyB0aGlzLm1hbnNvbnJ5SXRlbVNlbGVjdG9yQ2xhc3MsXHJcbiAgICAgICAgICAgIGNvbHVtbldpZHRoOiB0aGlzLndpZHRoLFxyXG4gICAgICAgICAgICBndXR0ZXI6IHRoaXMuZ3V0dGVyLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCB0aGF0ID0gdGhpcztcclxuXHJcbiAgICAgICAgdGhpcy5tc25yeS5vbignbGF5b3V0Q29tcGxldGUnLCBmdW5jdGlvbiAoaXRlbXMpIHtcclxuICAgICAgICAgICAgdGhhdC5sYXlvdXRDb21wbGV0ZS5uZXh0KGl0ZW1zKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5tc25yeS5vbigncmVtb3ZlQ29tcGxldGUnLCBmdW5jdGlvbiAoaXRlbXMpIHtcclxuICAgICAgICAgICAgdGhhdC5yZW1vdmVDb21wbGV0ZS5uZXh0KGl0ZW1zKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlbW92ZUltYWdlRnJvbUdhbGxlcnkoaW1hZ2U6IElNYXNvbnJ5R2FsbGVyeUltYWdlKTogdm9pZCB7XHJcbiAgICAgICAgLy8gZ2V0IGltYWdlIGd1aWRcclxuICAgICAgICBjb25zdCBpbWFnZUlkUmVzdWx0ID0gdGhpcy5hY3RpdmVJbWFnZXMuZmluZChcclxuICAgICAgICAgICAgbSA9PiBtLmltYWdlLmltYWdlVXJsLnRvTG93ZXJDYXNlKCkgPT09IGltYWdlLmltYWdlVXJsLnRvTG93ZXJDYXNlKClcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAoIWltYWdlSWRSZXN1bHQpIHtcclxuICAgICAgICAgICAgLy8gaW1hZ2Ugd2FzIG5vdCBmb3VuZCwgdGhpcyBpcyBwcm9iYWJseSBhbiBlcnJvclxyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXHJcbiAgICAgICAgICAgICAgICBgSW1hZ2Ugd2l0aCB1cmwgJyR7XHJcbiAgICAgICAgICAgICAgICBpbWFnZS5pbWFnZVVybFxyXG4gICAgICAgICAgICAgICAgfScgd2FzIG5vdCBmb3VuZC4gSWYgeW91IGFyZSBhZGRpbmcgaW1hZ2VzLCBtYWtlIHN1cmUgdG8gJ3JlcGxhY2UnIHRoZSBpbWFnZXMgYXJyYXkgd2l0aCBhIG5ldyBvbmVcclxuICAgICAgICAgICAgICAgIHNvIHRoYXQgZGV0ZWN0aW9uIGNoYW5nZSBjYW4gYmUgZXhlY3V0ZWQgaW5zdGVhZCBvZiBqdXN0IGFkZGluZyBhbiBpbWFnZSB0byBhcnJheVxyXG4gICAgICAgICAgICAgICAgKHdoaWNoIGRvZXNuJ3QgZmlyZSBjaGFuZ2UgZGV0ZWN0aW9uIG9uIGFycmF5IHByb3BlcnR5KWBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZmluZCBpbWFnZSBiYXNlZCBvbiBpdHMgaWRcclxuICAgICAgICBjb25zdCBpbWFnZUVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbWFnZUlkUmVzdWx0LmlkKTtcclxuXHJcbiAgICAgICAgaWYgKCFpbWFnZUVsZW0pIHtcclxuICAgICAgICAgICAgLy8gaW1hZ2Ugd2FzIG5vdCBmb3VuZCBpbiBET01cclxuICAgICAgICAgICAgY29uc29sZS53YXJuKFxyXG4gICAgICAgICAgICAgICAgYEltYWdlIHdpdGggaWQgJ3ske1xyXG4gICAgICAgICAgICAgICAgaW1hZ2VJZFJlc3VsdC5pZFxyXG4gICAgICAgICAgICAgICAgfX0nIHdhcyBub3QgZm91bmQgaW4gRE9NLiBIYXZlIHlvdSBtYW5pcHVsYXRlZCB0aGUgRE9NIGluIHNvbWUgd2F5P2BcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gcmVtb3ZlIGltYWdlIGZyb20gZ2FsbGVyeVxyXG4gICAgICAgIHRoaXMubXNucnkucmVtb3ZlKGltYWdlRWxlbSk7XHJcblxyXG4gICAgICAgIC8vIHJlZnJlc2ggbGF5b3V0XHJcbiAgICAgICAgdGhpcy5tc25yeS5sYXlvdXQoKTtcclxuXHJcbiAgICAgICAgLy8gcmVtb3ZlIGltYWdlIGZyb20gYXJyYXlcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYWN0aXZlSW1hZ2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkV2l0aEltYWdlID0gdGhpcy5hY3RpdmVJbWFnZXNbaV07XHJcbiAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgIGlkV2l0aEltYWdlLmltYWdlLmltYWdlVXJsLnRvTG93ZXJDYXNlKCkgPT09XHJcbiAgICAgICAgICAgICAgICBpbWFnZUlkUmVzdWx0LmltYWdlLmltYWdlVXJsLnRvTG93ZXJDYXNlKClcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUltYWdlcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhZGRJbWFnZXNUb0dhbGxlcnkoaW1hZ2VzOiBJTWFzb25yeUdhbGxlcnlJbWFnZVtdKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmdyaWQpIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXHJcbiAgICAgICAgICAgICAgICAnR3JpZCBlbGVtZW50IGlzIG5vdCB5ZXQgcmVhZHksIGFyZSB5b3UgdHJ5aW5nIHRvIGFkZCBpbWFnZSB0b28gc29vbj8nXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBpbWFnZXNXcmFwcGVyID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcblxyXG4gICAgICAgIGltYWdlcy5mb3JFYWNoKGltYWdlID0+IHtcclxuICAgICAgICAgICAgLy8gZ2VuZXJhdGUgdW5pcXVlIGltYWdlIGlkXHJcbiAgICAgICAgICAgIGNvbnN0IGltYWdlSWQgPSB0aGlzLmdldEltYWdlSWQoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBlbGVtZW50XHJcbiAgICAgICAgICAgIGNvbnN0IGltYWdlRWxlbSA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgICAgICAgICAgIGltYWdlRWxlbS5zZXRBdHRyaWJ1dGUoJ2lkJywgaW1hZ2VJZCk7XHJcbiAgICAgICAgICAgIGltYWdlRWxlbS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIGltYWdlLmFsdCA/IGltYWdlLmFsdCA6ICdubyBkZXNjcmlwdGlvbicpO1xyXG4gICAgICAgICAgICBpbWFnZUVsZW0uc2V0QXR0cmlidXRlKCdzcmMnLCBpbWFnZS5pbWFnZVVybCk7XHJcbiAgICAgICAgICAgIC8vIG5vdGUgLSBpbWFnZXMgYXJlIGhpZGRlbiBieSBkZWZhdWx0IGFuZCBzaG91bGQgYmUgc2hvd24gb25seSBhZnRlciB0aGV5IGFyZSBsb2FkZWRcclxuICAgICAgICAgICAgaW1hZ2VFbGVtLnNldEF0dHJpYnV0ZShcclxuICAgICAgICAgICAgICAgICdzdHlsZScsXHJcbiAgICAgICAgICAgICAgICBgZGlzcGxheTogbm9uZTsgd2lkdGg6ICR7dGhpcy53aWR0aH1weDsgbWFyZ2luLWJvdHRvbTogJHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmVydGljYWxHdXR0ZXJcclxuICAgICAgICAgICAgICAgIH1weGBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaW1hZ2VFbGVtLmNsYXNzTmFtZSA9IHRoaXMuZ2V0SW1hZ2VDbGFzcygpO1xyXG4gICAgICAgICAgICBpbWFnZUVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUNsaWNrKGltYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBzdG9yZSBndWlkIHdpdGggdGhpcyBpbWFnZVxyXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUltYWdlcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGlkOiBpbWFnZUlkLFxyXG4gICAgICAgICAgICAgICAgaW1hZ2U6IGltYWdlXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gYWRkIHRvIGRvbSBhbmQgbWFuc29yeSAmIHJlZnJlc2ggbGF5b3V0XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoaW1hZ2VzV3JhcHBlciwgaW1hZ2VFbGVtKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gYWRkIGh0bWwgdG8gZG9tXHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLmdyaWQsIGltYWdlc1dyYXBwZXIpO1xyXG5cclxuICAgICAgICAvLyBhZGQgaW1hZ2VzIG9uY2UgdGhleSBhcmUgbG9hZGVkXHJcbiAgICAgICAgY29uc3QgaW1nTG9hZCA9IGltYWdlc0xvYWRlZE1ldGhvZChpbWFnZXNXcmFwcGVyKTtcclxuICAgICAgICBpbWdMb2FkLm9uKCdwcm9ncmVzcycsIChpbnN0YW5jZSwgaW1hZ2UpID0+IHtcclxuICAgICAgICAgICAgaWYgKGltYWdlLmlzTG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuZ3JpZCwgaW1hZ2UuaW1nKTtcclxuICAgICAgICAgICAgICAgIC8vIHVuaGlkZSBpbWFnZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShpbWFnZS5pbWcsICdkaXNwbGF5JywgJ2Jsb2NrJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1zbnJ5LmFwcGVuZGVkKGltYWdlLmltZyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1zbnJ5LnJlbG9hZEl0ZW1zKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEltYWdlQ2xhc3MoKTogc3RyaW5nIHtcclxuICAgICAgICBsZXQgY2xhc3NOYW1lID0gdGhpcy5tYW5zb25yeUl0ZW1TZWxlY3RvckNsYXNzO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbWFnZUNsYXNzZXMgJiYgdGhpcy5pbWFnZUNsYXNzZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBjdXN0b21DbGFzcyA9IHRoaXMuaW1hZ2VDbGFzc2VzLmpvaW4oJyAnKTtcclxuXHJcbiAgICAgICAgICAgIGNsYXNzTmFtZSArPSAnICcgKyBjdXN0b21DbGFzcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjbGFzc05hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRJbWFnZUlkKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2FsbGVyeUd1aWQgKyAnXycgKyB1dGlsaXRpZXMubmV3R3VpZCgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5pbnRlcmZhY2UgQWN0aXZlSW1hZ2Uge1xyXG4gICAgaWQ6IHN0cmluZztcclxuICAgIGltYWdlOiBJTWFzb25yeUdhbGxlcnlJbWFnZTtcclxufVxyXG4iXX0=
{"ast":null,"code":"'use strict';\n\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\n\nvar typeFunc = require('type-func');\n\nvar animationFramePolyfill = require('animation-frame-polyfill');\n\nvar domSet = require('dom-set');\n\nvar domPlane = require('dom-plane');\n\nvar mousemoveDispatcher = _interopDefault(require('dom-mousemove-dispatcher'));\n\nfunction AutoScroller(elements, options) {\n  if (options === void 0) options = {};\n  var self = this;\n  var maxSpeed = 4,\n      scrolling = false;\n  this.margin = options.margin || -1; //this.scrolling = false;\n\n  this.scrollWhenOutside = options.scrollWhenOutside || false;\n  var point = {},\n      pointCB = domPlane.createPointCB(point),\n      dispatcher = mousemoveDispatcher(),\n      down = false;\n  window.addEventListener('mousemove', pointCB, false);\n  window.addEventListener('touchmove', pointCB, false);\n\n  if (!isNaN(options.maxSpeed)) {\n    maxSpeed = options.maxSpeed;\n  }\n\n  this.autoScroll = typeFunc.boolean(options.autoScroll);\n  this.syncMove = typeFunc.boolean(options.syncMove, false);\n\n  this.destroy = function (forceCleanAnimation) {\n    window.removeEventListener('mousemove', pointCB, false);\n    window.removeEventListener('touchmove', pointCB, false);\n    window.removeEventListener('mousedown', onDown, false);\n    window.removeEventListener('touchstart', onDown, false);\n    window.removeEventListener('mouseup', onUp, false);\n    window.removeEventListener('touchend', onUp, false);\n    window.removeEventListener('pointerup', onUp, false);\n    window.removeEventListener('mouseleave', onMouseOut, false);\n    window.removeEventListener('mousemove', onMove, false);\n    window.removeEventListener('touchmove', onMove, false);\n    window.removeEventListener('scroll', setScroll, true);\n    elements = [];\n\n    if (forceCleanAnimation) {\n      cleanAnimation();\n    }\n  };\n\n  this.add = function () {\n    var element = [],\n        len = arguments.length;\n\n    while (len--) {\n      element[len] = arguments[len];\n    }\n\n    domSet.addElements.apply(void 0, [elements].concat(element));\n    return this;\n  };\n\n  this.remove = function () {\n    var element = [],\n        len = arguments.length;\n\n    while (len--) {\n      element[len] = arguments[len];\n    }\n\n    return domSet.removeElements.apply(void 0, [elements].concat(element));\n  };\n\n  var hasWindow = null,\n      windowAnimationFrame;\n\n  if (Object.prototype.toString.call(elements) !== '[object Array]') {\n    elements = [elements];\n  }\n\n  (function (temp) {\n    elements = [];\n    temp.forEach(function (element) {\n      if (element === window) {\n        hasWindow = window;\n      } else {\n        self.add(element);\n      }\n    });\n  })(elements);\n\n  Object.defineProperties(this, {\n    down: {\n      get: function get() {\n        return down;\n      }\n    },\n    maxSpeed: {\n      get: function get() {\n        return maxSpeed;\n      }\n    },\n    point: {\n      get: function get() {\n        return point;\n      }\n    },\n    scrolling: {\n      get: function get() {\n        return scrolling;\n      }\n    }\n  });\n  var n = 0,\n      current = null,\n      animationFrame;\n  window.addEventListener('mousedown', onDown, false);\n  window.addEventListener('touchstart', onDown, false);\n  window.addEventListener('mouseup', onUp, false);\n  window.addEventListener('touchend', onUp, false);\n  /*\n  IE does not trigger mouseup event when scrolling.\n  It is a known issue that Microsoft won't fix.\n  https://connect.microsoft.com/IE/feedback/details/783058/scrollbar-trigger-mousedown-but-not-mouseup\n  IE supports pointer events instead\n  */\n\n  window.addEventListener('pointerup', onUp, false);\n  window.addEventListener('mousemove', onMove, false);\n  window.addEventListener('touchmove', onMove, false);\n  window.addEventListener('mouseleave', onMouseOut, false);\n  window.addEventListener('scroll', setScroll, true);\n\n  function setScroll(e) {\n    for (var i = 0; i < elements.length; i++) {\n      if (elements[i] === e.target) {\n        scrolling = true;\n        break;\n      }\n    }\n\n    if (scrolling) {\n      animationFramePolyfill.requestAnimationFrame(function () {\n        return scrolling = false;\n      });\n    }\n  }\n\n  function onDown() {\n    down = true;\n  }\n\n  function onUp() {\n    down = false;\n    cleanAnimation();\n  }\n\n  function cleanAnimation() {\n    animationFramePolyfill.cancelAnimationFrame(animationFrame);\n    animationFramePolyfill.cancelAnimationFrame(windowAnimationFrame);\n  }\n\n  function onMouseOut() {\n    down = false;\n  }\n\n  function getTarget(target) {\n    if (!target) {\n      return null;\n    }\n\n    if (current === target) {\n      return target;\n    }\n\n    if (domSet.hasElement(elements, target)) {\n      return target;\n    }\n\n    while (target = target.parentNode) {\n      if (domSet.hasElement(elements, target)) {\n        return target;\n      }\n    }\n\n    return null;\n  }\n\n  function getElementUnderPoint() {\n    var underPoint = null;\n\n    for (var i = 0; i < elements.length; i++) {\n      if (inside(point, elements[i])) {\n        underPoint = elements[i];\n      }\n    }\n\n    return underPoint;\n  }\n\n  function onMove(event) {\n    if (!self.autoScroll()) {\n      return;\n    }\n\n    if (event['dispatched']) {\n      return;\n    }\n\n    var target = event.target,\n        body = document.body;\n\n    if (current && !inside(point, current)) {\n      if (!self.scrollWhenOutside) {\n        current = null;\n      }\n    }\n\n    if (target && target.parentNode === body) {\n      //The special condition to improve speed.\n      target = getElementUnderPoint();\n    } else {\n      target = getTarget(target);\n\n      if (!target) {\n        target = getElementUnderPoint();\n      }\n    }\n\n    if (target && target !== current) {\n      current = target;\n    }\n\n    if (hasWindow) {\n      animationFramePolyfill.cancelAnimationFrame(windowAnimationFrame);\n      windowAnimationFrame = animationFramePolyfill.requestAnimationFrame(scrollWindow);\n    }\n\n    if (!current) {\n      return;\n    }\n\n    animationFramePolyfill.cancelAnimationFrame(animationFrame);\n    animationFrame = animationFramePolyfill.requestAnimationFrame(scrollTick);\n  }\n\n  function scrollWindow() {\n    autoScroll(hasWindow);\n    animationFramePolyfill.cancelAnimationFrame(windowAnimationFrame);\n    windowAnimationFrame = animationFramePolyfill.requestAnimationFrame(scrollWindow);\n  }\n\n  function scrollTick() {\n    if (!current) {\n      return;\n    }\n\n    autoScroll(current);\n    animationFramePolyfill.cancelAnimationFrame(animationFrame);\n    animationFrame = animationFramePolyfill.requestAnimationFrame(scrollTick);\n  }\n\n  function autoScroll(el) {\n    var rect = domPlane.getClientRect(el),\n        scrollx,\n        scrolly;\n\n    if (point.x < rect.left + self.margin) {\n      scrollx = Math.floor(Math.max(-1, (point.x - rect.left) / self.margin - 1) * self.maxSpeed);\n    } else if (point.x > rect.right - self.margin) {\n      scrollx = Math.ceil(Math.min(1, (point.x - rect.right) / self.margin + 1) * self.maxSpeed);\n    } else {\n      scrollx = 0;\n    }\n\n    if (point.y < rect.top + self.margin) {\n      scrolly = Math.floor(Math.max(-1, (point.y - rect.top) / self.margin - 1) * self.maxSpeed);\n    } else if (point.y > rect.bottom - self.margin) {\n      scrolly = Math.ceil(Math.min(1, (point.y - rect.bottom) / self.margin + 1) * self.maxSpeed);\n    } else {\n      scrolly = 0;\n    }\n\n    if (self.syncMove()) {\n      /*\n      Notes about mousemove event dispatch.\n      screen(X/Y) should need to be updated.\n      Some other properties might need to be set.\n      Keep the syncMove option default false until all inconsistencies are taken care of.\n      */\n      dispatcher.dispatch(el, {\n        pageX: point.pageX + scrollx,\n        pageY: point.pageY + scrolly,\n        clientX: point.x + scrollx,\n        clientY: point.y + scrolly\n      });\n    }\n\n    setTimeout(function () {\n      if (scrolly) {\n        scrollY(el, scrolly);\n      }\n\n      if (scrollx) {\n        scrollX(el, scrollx);\n      }\n    });\n  }\n\n  function scrollY(el, amount) {\n    if (el === window) {\n      window.scrollTo(el.pageXOffset, el.pageYOffset + amount);\n    } else {\n      el.scrollTop += amount;\n    }\n  }\n\n  function scrollX(el, amount) {\n    if (el === window) {\n      window.scrollTo(el.pageXOffset + amount, el.pageYOffset);\n    } else {\n      el.scrollLeft += amount;\n    }\n  }\n}\n\nfunction AutoScrollerFactory(element, options) {\n  return new AutoScroller(element, options);\n}\n\nfunction inside(point, el, rect) {\n  if (!rect) {\n    return domPlane.pointInside(point, el);\n  } else {\n    return point.y > rect.top && point.y < rect.bottom && point.x > rect.left && point.x < rect.right;\n  }\n}\n/*\ngit remote add origin https://github.com/hollowdoor/dom_autoscroller.git\ngit push -u origin master\n*/\n\n\nmodule.exports = AutoScrollerFactory;","map":{"version":3,"sources":["../src/index.js"],"names":["const","let","createPointCB","boolean","addElements","removeElements","requestFrame","cancelFrame","hasElement","getRect","pointInside"],"mappings":"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","sourcesContent":["import {boolean} from 'type-func';\r\nimport {\r\n    requestAnimationFrame as requestFrame,\r\n    cancelAnimationFrame as cancelFrame\r\n} from 'animation-frame-polyfill';\r\nimport {\r\n    hasElement,\r\n    addElements,\r\n    removeElements\r\n} from 'dom-set';\r\n\r\nimport {\r\n    createPointCB,\r\n    getClientRect as getRect,\r\n    pointInside\r\n} from 'dom-plane';\r\n\r\nimport mousemoveDispatcher from 'dom-mousemove-dispatcher';\r\n\r\nfunction AutoScroller(elements, options = {}){\r\n    const self = this;\r\n    let maxSpeed = 4, scrolling = false;\r\n\r\n    this.margin = options.margin || -1;\r\n    //this.scrolling = false;\r\n    this.scrollWhenOutside = options.scrollWhenOutside || false;\r\n\r\n    let point = {},\r\n        pointCB = createPointCB(point),\r\n        dispatcher = mousemoveDispatcher(),\r\n        down = false;\r\n\r\n    window.addEventListener('mousemove', pointCB, false);\r\n    window.addEventListener('touchmove', pointCB, false);\r\n\r\n    if(!isNaN(options.maxSpeed)){\r\n        maxSpeed = options.maxSpeed;\r\n    }\r\n\r\n    this.autoScroll = boolean(options.autoScroll);\r\n    this.syncMove = boolean(options.syncMove, false);\r\n\r\n    this.destroy = function(forceCleanAnimation) {\r\n        window.removeEventListener('mousemove', pointCB, false);\r\n        window.removeEventListener('touchmove', pointCB, false);\r\n        window.removeEventListener('mousedown', onDown, false);\r\n        window.removeEventListener('touchstart', onDown, false);\r\n        window.removeEventListener('mouseup', onUp, false);\r\n        window.removeEventListener('touchend', onUp, false);\r\n        window.removeEventListener('pointerup', onUp, false);\r\n        window.removeEventListener('mouseleave', onMouseOut, false);\r\n\r\n        window.removeEventListener('mousemove', onMove, false);\r\n        window.removeEventListener('touchmove', onMove, false);\r\n\r\n        window.removeEventListener('scroll', setScroll, true);\r\n        elements = [];\r\n        if(forceCleanAnimation){\r\n          cleanAnimation();\r\n        }\r\n    };\r\n\r\n    this.add = function(...element){\r\n        addElements(elements, ...element);\r\n        return this;\r\n    };\r\n\r\n    this.remove = function(...element){\r\n        return removeElements(elements, ...element);\r\n    };\r\n\r\n    let hasWindow = null, windowAnimationFrame;\r\n\r\n    if(Object.prototype.toString.call(elements) !== '[object Array]'){\r\n        elements = [elements];\r\n    }\r\n\r\n    (function(temp){\r\n        elements = [];\r\n        temp.forEach(function(element){\r\n            if(element === window){\r\n                hasWindow = window;\r\n            }else{\r\n                self.add(element);\r\n            }\r\n        })\r\n    }(elements));\r\n\r\n    Object.defineProperties(this, {\r\n        down: {\r\n            get: function(){ return down; }\r\n        },\r\n        maxSpeed: {\r\n            get: function(){ return maxSpeed; }\r\n        },\r\n        point: {\r\n            get: function(){ return point; }\r\n        },\r\n        scrolling: {\r\n            get: function(){ return scrolling; }\r\n        }\r\n    });\r\n\r\n    let n = 0, current = null, animationFrame;\r\n\r\n    window.addEventListener('mousedown', onDown, false);\r\n    window.addEventListener('touchstart', onDown, false);\r\n    window.addEventListener('mouseup', onUp, false);\r\n    window.addEventListener('touchend', onUp, false);\r\n\r\n    /*\r\n    IE does not trigger mouseup event when scrolling.\r\n    It is a known issue that Microsoft won't fix.\r\n    https://connect.microsoft.com/IE/feedback/details/783058/scrollbar-trigger-mousedown-but-not-mouseup\r\n    IE supports pointer events instead\r\n    */\r\n    window.addEventListener('pointerup', onUp, false);\r\n\r\n    window.addEventListener('mousemove', onMove, false);\r\n    window.addEventListener('touchmove', onMove, false);\r\n\r\n    window.addEventListener('mouseleave', onMouseOut, false);\r\n\r\n    window.addEventListener('scroll', setScroll, true);\r\n\r\n    function setScroll(e){\r\n\r\n        for(let i=0; i<elements.length; i++){\r\n            if(elements[i] === e.target){\r\n                scrolling = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if(scrolling){\r\n            requestFrame(()=>scrolling = false)\r\n        }\r\n    }\r\n\r\n    function onDown(){\r\n        down = true;\r\n    }\r\n\r\n    function onUp(){\r\n        down = false;\r\n        cleanAnimation();\r\n    }\r\n    function cleanAnimation(){\r\n      cancelFrame(animationFrame);\r\n      cancelFrame(windowAnimationFrame);\r\n    }\r\n    function onMouseOut(){\r\n        down = false;\r\n    }\r\n\r\n    function getTarget(target){\r\n        if(!target){\r\n            return null;\r\n        }\r\n\r\n        if(current === target){\r\n            return target;\r\n        }\r\n\r\n        if(hasElement(elements, target)){\r\n            return target;\r\n        }\r\n\r\n        while(target = target.parentNode){\r\n            if(hasElement(elements, target)){\r\n                return target;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    function getElementUnderPoint(){\r\n        let underPoint = null;\r\n\r\n        for(var i=0; i<elements.length; i++){\r\n            if(inside(point, elements[i])){\r\n                underPoint = elements[i];\r\n            }\r\n        }\r\n\r\n        return underPoint;\r\n    }\r\n\r\n\r\n    function onMove(event){\r\n\r\n        if(!self.autoScroll()) return;\r\n\r\n        if(event['dispatched']){ return; }\r\n\r\n        let target = event.target, body = document.body;\r\n\r\n        if(current && !inside(point, current)){\r\n            if(!self.scrollWhenOutside){\r\n                current = null;\r\n            }\r\n        }\r\n\r\n        if(target && target.parentNode === body){\r\n            //The special condition to improve speed.\r\n            target = getElementUnderPoint();\r\n        }else{\r\n            target = getTarget(target);\r\n\r\n            if(!target){\r\n                target = getElementUnderPoint();\r\n            }\r\n        }\r\n\r\n\r\n        if(target && target !== current){\r\n            current = target;\r\n        }\r\n\r\n        if(hasWindow){\r\n            cancelFrame(windowAnimationFrame);\r\n            windowAnimationFrame = requestFrame(scrollWindow);\r\n        }\r\n\r\n\r\n        if(!current){\r\n            return;\r\n        }\r\n\r\n        cancelFrame(animationFrame);\r\n        animationFrame = requestFrame(scrollTick);\r\n    }\r\n\r\n    function scrollWindow(){\r\n        autoScroll(hasWindow);\r\n\r\n        cancelFrame(windowAnimationFrame);\r\n        windowAnimationFrame = requestFrame(scrollWindow);\r\n    }\r\n\r\n    function scrollTick(){\r\n\r\n        if(!current){\r\n            return;\r\n        }\r\n\r\n        autoScroll(current);\r\n\r\n        cancelFrame(animationFrame);\r\n        animationFrame = requestFrame(scrollTick);\r\n\r\n    }\r\n\r\n\r\n    function autoScroll(el){\r\n        let rect = getRect(el), scrollx, scrolly;\r\n\r\n        if(point.x < rect.left + self.margin){\r\n            scrollx = Math.floor(\r\n                Math.max(-1, (point.x - rect.left) / self.margin - 1) * self.maxSpeed\r\n            );\r\n        }else if(point.x > rect.right - self.margin){\r\n            scrollx = Math.ceil(\r\n                Math.min(1, (point.x - rect.right) / self.margin + 1) * self.maxSpeed\r\n            );\r\n        }else{\r\n            scrollx = 0;\r\n        }\r\n\r\n        if(point.y < rect.top + self.margin){\r\n            scrolly = Math.floor(\r\n                Math.max(-1, (point.y - rect.top) / self.margin - 1) * self.maxSpeed\r\n            );\r\n        }else if(point.y > rect.bottom - self.margin){\r\n            scrolly = Math.ceil(\r\n                Math.min(1, (point.y - rect.bottom) / self.margin + 1) * self.maxSpeed\r\n            );\r\n        }else{\r\n            scrolly = 0;\r\n        }\r\n\r\n        if(self.syncMove()){\r\n            /*\r\n            Notes about mousemove event dispatch.\r\n            screen(X/Y) should need to be updated.\r\n            Some other properties might need to be set.\r\n            Keep the syncMove option default false until all inconsistencies are taken care of.\r\n            */\r\n            dispatcher.dispatch(el, {\r\n                pageX: point.pageX + scrollx,\r\n                pageY: point.pageY + scrolly,\r\n                clientX: point.x + scrollx,\r\n                clientY: point.y + scrolly\r\n            });\r\n        }\r\n\r\n        setTimeout(()=>{\r\n\r\n            if(scrolly){\r\n                scrollY(el, scrolly);\r\n            }\r\n\r\n            if(scrollx){\r\n                scrollX(el, scrollx);\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    function scrollY(el, amount){\r\n        if(el === window){\r\n            window.scrollTo(el.pageXOffset, el.pageYOffset + amount);\r\n        }else{\r\n            el.scrollTop += amount;\r\n        }\r\n    }\r\n\r\n    function scrollX(el, amount){\r\n        if(el === window){\r\n            window.scrollTo(el.pageXOffset + amount, el.pageYOffset);\r\n        }else{\r\n            el.scrollLeft += amount;\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport default function AutoScrollerFactory(element, options){\r\n    return new AutoScroller(element, options);\r\n}\r\n\r\nfunction inside(point, el, rect){\r\n    if(!rect){\r\n        return pointInside(point, el);\r\n    }else{\r\n        return (point.y > rect.top && point.y < rect.bottom &&\r\n                point.x > rect.left && point.x < rect.right);\r\n    }\r\n}\r\n\r\n/*\r\ngit remote add origin https://github.com/hollowdoor/dom_autoscroller.git\r\ngit push -u origin master\r\n*/\r\n"]},"metadata":{},"sourceType":"script"}